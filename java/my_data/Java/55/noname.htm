<html>
<title>在浏览器中解析Base64编码图像</title>
<body>
<!--StartFragment--> 
<span class="Apple-style-span" style="border-collapse: separate; color: rgb(0, 0, 0); font-family: Simsun; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; font-size: medium; "><span class="Apple-style-span" style="color: rgb(68, 68, 68); font-family: Tahoma, Verdana, sans-serif; font-size: 12px; line-height: 16px; text-align: justify; ">
<p style="font-size: 1.05em; ">上一篇介绍中，我们将二进制文件(BLOB)保存为Base64编码的文本，这些文本可以内嵌在XML的标签中，因此二进制信息它可以随着XML文件被拷贝、下载而不用担心信息会缺失。这项技术也在email邮件中被广泛使用。</p>
<p style="font-size: 1.05em; "><strong>浏览器对Base64的支持</strong><br>
  图像是最经常被使用的一种二进制文件。而现代的浏览器的进步日新月异，IE7，FireFox和其他浏览器为包括Base64在内各种编码的图像信息提供了很好的支持。因此图形信息可以以下面的形式呈现在页面中、</p>
<div class="codesnip-container" style="border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-top-color: rgb(204, 204, 204); border-right-color: rgb(204, 204, 204); border-bottom-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: rgb(238, 238, 238); padding-top: 5px; padding-right: 5px; padding-bottom: 5px; padding-left: 5px; margin-top: 10px; margin-right: 10px; margin-bottom: 10px; margin-left: 10px; background-position: initial initial; background-repeat: initial initial; ">
  <div class="html4strict codesnip" style="text-align: left; direction: ltr; font-family: monospace; "><span class="sc2">&lt;<a href="http://december.com/html/4/element/img.html" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">img</span></a><span class="Apple-converted-space">&nbsp;</span><span class="kw3" style="color: rgb(0, 0, 102); ">src</span><span class="sy0">=</span><span class="st0" style="color: rgb(255, 0, 0); ">"data:image/gif;base64,R0lGODlhDwAPAKECAAAAzMzM/////</span><br>
    <span class="sc2">wAAACwAAAAADwAPAAACIISPeQHsrZ5ModrLlN48CXF8m2iQ3YmmKqVlRtW4ML</span><br>
    <span class="sc2">wWACH+H09wdGltaXplZCBieSBVbGVhZCBTbWFydFNhdmVyIQAAOw=="</span></span><br>
  <span class="sc2"><span class="kw3" style="color: rgb(0, 0, 102); ">alt</span><span class="sy0">=</span><span class="st0" style="color: rgb(255, 0, 0); ">"Base64 encoded image"</span><span class="Apple-converted-space">&nbsp;</span><span class="kw3" style="color: rgb(0, 0, 102); ">width</span><span class="sy0">=</span><span class="st0" style="color: rgb(255, 0, 0); ">"150"</span><span class="Apple-converted-space">&nbsp;</span><span class="kw3" style="color: rgb(0, 0, 102); ">height</span><span class="sy0">=</span><span class="st0" style="color: rgb(255, 0, 0); ">"150"</span><span class="sy0">/</span>&gt;</span></div>
</div>
<p style="font-size: 1.05em; ">这种data: URI的格式能把Base64（或其他数据）可以内嵌在image标签的属性当中（或者CSS中）。我们可以看到在大部分浏览器中的显示效果：<br>
<a href="http://blogs.ejb.cc/wp-content/uploads/2010/10/example.gif" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><img src="example.gif" alt="" title="example" width="150" height="150" class="alignnone size-full wp-image-213" style="padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; max-width: 100%; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; "></a></p>
<p style="font-size: 1.05em; ">这种做法有利有弊，好处是浏览器可以在一个连接中得到完成的页面内容，不好的地方时图像的大小会增加1/3。因此，这种内嵌的方法适合对小的图形元素比如图标、圆角等等进行处理，从而减少浏览器打开的连接数，但对大的照片、图片（量少而大）等等则不应该使用Base64编码以免影响下载速度。<br>
  <span id="more-212"></span><br>
  为了得到刚才的Base64编码，我们将上一篇的Java修改成Struts Action，并借用了JIMI进行图形的读取和格式转换，Base64编码器则改为更普遍的Apache Commons组件，代码如下：</p>
<div class="codesnip-container" style="border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-top-color: rgb(204, 204, 204); border-right-color: rgb(204, 204, 204); border-bottom-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: rgb(238, 238, 238); padding-top: 5px; padding-right: 5px; padding-bottom: 5px; padding-left: 5px; margin-top: 10px; margin-right: 10px; margin-bottom: 10px; margin-left: 10px; background-position: initial initial; background-repeat: initial initial; ">
  <div class="java codesnip" style="text-align: left; direction: ltr; font-family: monospace; "><span class="kw1" style="color: rgb(161, 161, 0); ">package</span><span class="Apple-converted-space">&nbsp;</span><span class="co2" style="color: rgb(128, 128, 128); ">cc.ejb.arabic.controller</span><span class="sy0">;</span><br>
    <span class="kw1" style="color: rgb(161, 161, 0); ">import</span><span class="Apple-converted-space">&nbsp;</span><span class="co2" style="color: rgb(128, 128, 128); ">java.awt.Image</span><span class="sy0">;</span><br>
    <span class="kw1" style="color: rgb(161, 161, 0); ">import</span><span class="Apple-converted-space">&nbsp;</span><span class="co2" style="color: rgb(128, 128, 128); ">java.io.ByteArrayOutputStream</span><span class="sy0">;</span><br>
    <span class="kw1" style="color: rgb(161, 161, 0); ">import</span><span class="Apple-converted-space">&nbsp;</span><span class="co2" style="color: rgb(128, 128, 128); ">java.io.File</span><span class="sy0">;</span><br>
    <span class="kw1" style="color: rgb(161, 161, 0); ">import</span><span class="Apple-converted-space">&nbsp;</span><span class="co2" style="color: rgb(128, 128, 128); ">java.io.IOException</span><span class="sy0">;</span><br>
    <span class="kw1" style="color: rgb(161, 161, 0); ">import</span><span class="Apple-converted-space">&nbsp;</span><span class="co2" style="color: rgb(128, 128, 128); ">org.apache.commons.codec.binary.Base64</span><span class="sy0">;</span><br>
    <span class="kw1" style="color: rgb(161, 161, 0); ">import</span><span class="Apple-converted-space">&nbsp;</span><span class="co2" style="color: rgb(128, 128, 128); ">com.opensymphony.xwork2.ActionSupport</span><span class="sy0">;</span><br>
    <span class="kw1" style="color: rgb(161, 161, 0); ">import</span><span class="Apple-converted-space">&nbsp;</span><span class="co2" style="color: rgb(128, 128, 128); ">com.sun.jimi.core.Jimi</span><span class="sy0">;</span><br>
    <span class="kw1" style="color: rgb(161, 161, 0); ">import</span><span class="Apple-converted-space">&nbsp;</span><span class="co2" style="color: rgb(128, 128, 128); ">com.sun.jimi.core.JimiException</span><span class="sy0">;</span><br>
    <span class="kw1" style="color: rgb(161, 161, 0); ">import</span><span class="Apple-converted-space">&nbsp;</span><span class="co2" style="color: rgb(128, 128, 128); ">com.sun.jimi.core.JimiReader</span><span class="sy0">;</span>
    <p style="font-size: 1.05em; "></p>
    <p style="font-size: 1.05em; "><span class="kw1" style="color: rgb(161, 161, 0); ">public</span><span class="Apple-converted-space">&nbsp;</span><span class="kw1" style="color: rgb(161, 161, 0); ">class</span><span class="Apple-converted-space">&nbsp;</span>Base64ImageAction<span class="Apple-converted-space">&nbsp;</span><span class="kw1" style="color: rgb(161, 161, 0); ">extends</span><span class="Apple-converted-space">&nbsp;</span>ActionSupport<span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">{</span></p>
    <p style="font-size: 1.05em; ">&nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="kw1" style="color: rgb(161, 161, 0); ">private</span><span class="Apple-converted-space">&nbsp;</span><span class="kw1" style="color: rgb(161, 161, 0); ">final</span><span class="Apple-converted-space">&nbsp;</span><span class="kw1" style="color: rgb(161, 161, 0); ">static</span><span class="Apple-converted-space">&nbsp;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Astring+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw3" style="color: rgb(0, 0, 102); ">String</span></a><span class="Apple-converted-space">&nbsp;</span>galleryName<span class="Apple-converted-space">&nbsp;</span><span class="sy0">=</span><span class="Apple-converted-space">&nbsp;</span><span class="st0" style="color: rgb(255, 0, 0); ">"gallery"</span><span class="sy0">;</span><br>
      &nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="kw1" style="color: rgb(161, 161, 0); ">private</span><span class="Apple-converted-space">&nbsp;</span><span class="kw1" style="color: rgb(161, 161, 0); ">static</span><span class="Apple-converted-space">&nbsp;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Astring+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw3" style="color: rgb(0, 0, 102); ">String</span></a><span class="Apple-converted-space">&nbsp;</span>parent<span class="Apple-converted-space">&nbsp;</span><span class="sy0">=</span><span class="Apple-converted-space">&nbsp;</span><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">null</span><span class="sy0">;</span><br>
      &nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="kw1" style="color: rgb(161, 161, 0); ">private</span><span class="Apple-converted-space">&nbsp;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Astring+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw3" style="color: rgb(0, 0, 102); ">String</span></a><span class="Apple-converted-space">&nbsp;</span>fileName<span class="Apple-converted-space">&nbsp;</span><span class="sy0">=</span><span class="Apple-converted-space">&nbsp;</span><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">null</span><span class="sy0">;</span><br>
    &nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="kw1" style="color: rgb(161, 161, 0); ">private</span><span class="Apple-converted-space">&nbsp;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Astring+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw3" style="color: rgb(0, 0, 102); ">String</span></a><span class="Apple-converted-space">&nbsp;</span>encodeString<span class="Apple-converted-space">&nbsp;</span><span class="sy0">=</span><span class="Apple-converted-space">&nbsp;</span><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">null</span><span class="sy0">;</span></p>
    <p style="font-size: 1.05em; ">&nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="kw1" style="color: rgb(161, 161, 0); ">public</span><span class="Apple-converted-space">&nbsp;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Astring+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw3" style="color: rgb(0, 0, 102); ">String</span></a><span class="Apple-converted-space">&nbsp;</span>getEncodeString<span class="br0" style="color: rgb(102, 204, 102); ">(</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span><span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">{</span><br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="kw1" style="color: rgb(161, 161, 0); ">return</span><span class="Apple-converted-space">&nbsp;</span>encodeString<span class="sy0">;</span><br>
    &nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">}</span></p>
    <p style="font-size: 1.05em; ">&nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="kw1" style="color: rgb(161, 161, 0); ">public</span><span class="Apple-converted-space">&nbsp;</span><span class="kw4" style="color: rgb(246, 51, 51); ">void</span><span class="Apple-converted-space">&nbsp;</span>setEncodeString<span class="br0" style="color: rgb(102, 204, 102); ">(</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Astring+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw3" style="color: rgb(0, 0, 102); ">String</span></a><span class="Apple-converted-space">&nbsp;</span>encodeString<span class="br0" style="color: rgb(102, 204, 102); ">)</span><span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">{</span><br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="kw1" style="color: rgb(161, 161, 0); ">this</span>.<span class="me1">encodeString</span><span class="Apple-converted-space">&nbsp;</span><span class="sy0">=</span><span class="Apple-converted-space">&nbsp;</span>encodeString<span class="sy0">;</span><br>
    &nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">}</span></p>
    <p style="font-size: 1.05em; ">&nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="kw1" style="color: rgb(161, 161, 0); ">public</span><span class="Apple-converted-space">&nbsp;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Astring+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw3" style="color: rgb(0, 0, 102); ">String</span></a><span class="Apple-converted-space">&nbsp;</span>getFileName<span class="br0" style="color: rgb(102, 204, 102); ">(</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span><span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">{</span><br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="kw1" style="color: rgb(161, 161, 0); ">return</span><span class="Apple-converted-space">&nbsp;</span>fileName<span class="sy0">;</span><br>
    &nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">}</span></p>
    <p style="font-size: 1.05em; ">&nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="kw1" style="color: rgb(161, 161, 0); ">public</span><span class="Apple-converted-space">&nbsp;</span><span class="kw4" style="color: rgb(246, 51, 51); ">void</span><span class="Apple-converted-space">&nbsp;</span>setFileName<span class="br0" style="color: rgb(102, 204, 102); ">(</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Astring+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw3" style="color: rgb(0, 0, 102); ">String</span></a><span class="Apple-converted-space">&nbsp;</span>fileName<span class="br0" style="color: rgb(102, 204, 102); ">)</span><span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">{</span><br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="kw1" style="color: rgb(161, 161, 0); ">this</span>.<span class="me1">fileName</span><span class="Apple-converted-space">&nbsp;</span><span class="sy0">=</span><span class="Apple-converted-space">&nbsp;</span>fileName<span class="sy0">;</span><br>
    &nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">}</span></p>
    <p style="font-size: 1.05em; ">&nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="kw1" style="color: rgb(161, 161, 0); ">private</span><span class="Apple-converted-space">&nbsp;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Astring+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw3" style="color: rgb(0, 0, 102); ">String</span></a><span class="Apple-converted-space">&nbsp;</span>getImageFullPath<span class="br0" style="color: rgb(102, 204, 102); ">(</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span><span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">{</span><br>
    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="kw1" style="color: rgb(161, 161, 0); ">if</span><span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">(</span>parent<span class="Apple-converted-space">&nbsp;</span><span class="sy0">==</span><span class="Apple-converted-space">&nbsp;</span><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">null</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span><span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">{</span></p>
    <p style="font-size: 1.05em; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; parent<span class="Apple-converted-space">&nbsp;</span><span class="sy0">=</span><span class="Apple-converted-space">&nbsp;</span><span class="kw1" style="color: rgb(161, 161, 0); ">new</span><span class="Apple-converted-space">&nbsp;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Afile+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw3" style="color: rgb(0, 0, 102); ">File</span></a><span class="br0" style="color: rgb(102, 204, 102); ">(</span><span class="kw1" style="color: rgb(161, 161, 0); ">this</span>.<span class="me1">getClass</span><span class="br0" style="color: rgb(102, 204, 102); ">(</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span>.<span class="me1">getClassLoader</span><span class="br0" style="color: rgb(102, 204, 102); ">(</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span>.<span class="me1">getResource</span><span class="br0" style="color: rgb(102, 204, 102); ">(</span><br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Afile+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw3" style="color: rgb(0, 0, 102); ">File</span></a>.<span class="me1">separator</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span>.<span class="me1">getPath</span><span class="br0" style="color: rgb(102, 204, 102); ">(</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span>.<span class="me1">getParent</span><span class="br0" style="color: rgb(102, 204, 102); ">(</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span><span class="sy0">;</span><br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">}</span><br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="kw1" style="color: rgb(161, 161, 0); ">return</span><span class="Apple-converted-space">&nbsp;</span>parent<span class="Apple-converted-space">&nbsp;</span><span class="sy0">+</span><span class="Apple-converted-space">&nbsp;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Afile+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw3" style="color: rgb(0, 0, 102); ">File</span></a>.<span class="me1">separator</span><span class="Apple-converted-space">&nbsp;</span><span class="sy0">+</span><span class="Apple-converted-space">&nbsp;</span>galleryName<span class="Apple-converted-space">&nbsp;</span><span class="sy0">+</span><span class="Apple-converted-space">&nbsp;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Afile+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw3" style="color: rgb(0, 0, 102); ">File</span></a>.<span class="me1">separator</span><br>
    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="sy0">+</span><span class="Apple-converted-space">&nbsp;</span><span class="kw1" style="color: rgb(161, 161, 0); ">this</span>.<span class="me1">fileName</span><span class="sy0">;</span></p>
    <p style="font-size: 1.05em; ">&nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">}</span></p>
    <p style="font-size: 1.05em; ">&nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="kw1" style="color: rgb(161, 161, 0); ">public</span><span class="Apple-converted-space">&nbsp;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Astring+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw3" style="color: rgb(0, 0, 102); ">String</span></a><span class="Apple-converted-space">&nbsp;</span>execute<span class="br0" style="color: rgb(102, 204, 102); ">(</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span><span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">{</span><br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Abytearrayoutputstream+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw3" style="color: rgb(0, 0, 102); ">ByteArrayOutputStream</span></a><span class="Apple-converted-space">&nbsp;</span>output<span class="Apple-converted-space">&nbsp;</span><span class="sy0">=</span><span class="Apple-converted-space">&nbsp;</span><span class="kw1" style="color: rgb(161, 161, 0); ">new</span><span class="Apple-converted-space">&nbsp;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Abytearrayoutputstream+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw3" style="color: rgb(0, 0, 102); ">ByteArrayOutputStream</span></a><span class="br0" style="color: rgb(102, 204, 102); ">(</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span><span class="sy0">;</span><br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="kw1" style="color: rgb(161, 161, 0); ">try</span><span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">{</span><br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; JimiReader reader<span class="Apple-converted-space">&nbsp;</span><span class="sy0">=</span><span class="Apple-converted-space">&nbsp;</span>Jimi.<span class="me1">createJimiReader</span><span class="br0" style="color: rgb(102, 204, 102); ">(</span><span class="kw1" style="color: rgb(161, 161, 0); ">this</span>.<span class="me1">getImageFullPath</span><span class="br0" style="color: rgb(102, 204, 102); ">(</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span><span class="sy0">;</span><br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Aimage+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw3" style="color: rgb(0, 0, 102); ">Image</span></a><span class="Apple-converted-space">&nbsp;</span>image<span class="Apple-converted-space">&nbsp;</span><span class="sy0">=</span><span class="Apple-converted-space">&nbsp;</span>reader.<span class="me1">getImage</span><span class="br0" style="color: rgb(102, 204, 102); ">(</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span><span class="sy0">;</span><br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Jimi.<span class="me1">putImage</span><span class="br0" style="color: rgb(102, 204, 102); ">(</span><span class="st0" style="color: rgb(255, 0, 0); ">"image/png"</span>, image, output<span class="br0" style="color: rgb(102, 204, 102); ">)</span><span class="sy0">;</span><br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; output.<span class="me1">flush</span><span class="br0" style="color: rgb(102, 204, 102); ">(</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span><span class="sy0">;</span><br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; output.<span class="me1">close</span><span class="br0" style="color: rgb(102, 204, 102); ">(</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span><span class="sy0">;</span><br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="kw1" style="color: rgb(161, 161, 0); ">this</span>.<span class="me1">encodeString</span><span class="Apple-converted-space">&nbsp;</span><span class="sy0">=</span><span class="Apple-converted-space">&nbsp;</span>Base64.<span class="me1">encodeBase64String</span><span class="br0" style="color: rgb(102, 204, 102); ">(</span>output.<span class="me1">toByteArray</span><span class="br0" style="color: rgb(102, 204, 102); ">(</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span><span class="sy0">;</span><br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">}</span><span class="Apple-converted-space">&nbsp;</span><span class="kw1" style="color: rgb(161, 161, 0); ">catch</span><span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">(</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Aioexception+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw3" style="color: rgb(0, 0, 102); ">IOException</span></a><span class="Apple-converted-space">&nbsp;</span>e<span class="br0" style="color: rgb(102, 204, 102); ">)</span><span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">{</span><br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; e.<span class="me1">printStackTrace</span><span class="br0" style="color: rgb(102, 204, 102); ">(</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span><span class="sy0">;</span><br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">}</span><span class="Apple-converted-space">&nbsp;</span><span class="kw1" style="color: rgb(161, 161, 0); ">catch</span><span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">(</span>JimiException e<span class="br0" style="color: rgb(102, 204, 102); ">)</span><span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">{</span><br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; e.<span class="me1">printStackTrace</span><span class="br0" style="color: rgb(102, 204, 102); ">(</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span><span class="sy0">;</span><br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">}</span><br>
      &nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="kw1" style="color: rgb(161, 161, 0); ">return</span><span class="Apple-converted-space">&nbsp;</span>SUCCESS<span class="sy0">;</span><br>
      &nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">}</span><br>
    <span class="br0" style="color: rgb(102, 204, 102); ">}</span></p>
  </div>
</div>
<p style="font-size: 1.05em; ">对应的View端是个十分简单的Freemarker模板:</p>
<div class="codesnip-container" style="border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-top-color: rgb(204, 204, 204); border-right-color: rgb(204, 204, 204); border-bottom-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: rgb(238, 238, 238); padding-top: 5px; padding-right: 5px; padding-bottom: 5px; padding-left: 5px; margin-top: 10px; margin-right: 10px; margin-bottom: 10px; margin-left: 10px; background-position: initial initial; background-repeat: initial initial; ">
  <div class="html4strict codesnip" style="text-align: left; direction: ltr; font-family: monospace; "><span class="sc2">&lt;<a href="http://december.com/html/4/element/html.html" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">html</span></a>&gt;</span><br>
    <span class="sc2">&lt;<a href="http://december.com/html/4/element/head.html" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">head</span></a>&gt;</span><br>
    <span class="sc2">&lt;<a href="http://december.com/html/4/element/title.html" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">title</span></a>&gt;</span>Hello,World<span class="sc2">&lt;<span class="sy0">/</span><a href="http://december.com/html/4/element/title.html" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">title</span></a>&gt;</span><br>
    <span class="sc2">&lt;<span class="sy0">/</span><a href="http://december.com/html/4/element/head.html" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">head</span></a>&gt;</span><br>
    <span class="sc2">&lt;<a href="http://december.com/html/4/element/body.html" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">body</span></a>&gt;</span><br>
    <span class="sc2">&lt;<a href="http://december.com/html/4/element/img.html" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">img</span></a><span class="Apple-converted-space">&nbsp;</span><span class="kw3" style="color: rgb(0, 0, 102); ">src</span><span class="sy0">=</span><span class="st0" style="color: rgb(255, 0, 0); ">"data:image/png;base64,${encodeString}"</span><span class="Apple-converted-space">&nbsp;</span><span class="sy0">/</span>&gt;</span><br>
    <span class="sc2">&lt;<span class="sy0">/</span><a href="http://december.com/html/4/element/body.html" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">body</span></a>&gt;</span><br>
  <span class="sc2">&lt;<span class="sy0">/</span><a href="http://december.com/html/4/element/html.html" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">html</span></a>&gt;</span></div>
</div>
<p style="font-size: 1.05em; "><strong>处理古代浏览器</strong><br>
  世界总是不是那么完美，尽管大部分现代浏览器对Base64的处理都十分完善，但是我们不能不考虑到一些“古老”的浏览器，而现在还是普遍使用的“古老”的浏览器，就当属IE6，在IE6里试图浏览上面的图片可能会得到一个红叉叉。我们不得不为IE6做一些特殊处理,利用下面的javascript,我们把Base64字串传回服务器端，重新解析成图片</p>
<div class="codesnip-container" style="border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-top-color: rgb(204, 204, 204); border-right-color: rgb(204, 204, 204); border-bottom-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: rgb(238, 238, 238); padding-top: 5px; padding-right: 5px; padding-bottom: 5px; padding-left: 5px; margin-top: 10px; margin-right: 10px; margin-bottom: 10px; margin-left: 10px; background-position: initial initial; background-repeat: initial initial; ">
  <div class="javascript codesnip" style="text-align: left; direction: ltr; font-family: monospace; "><span class="co1" style="color: rgb(128, 128, 128); ">// a regular expression to test for Base64 data</span><br>
    <span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">var</span><span class="Apple-converted-space">&nbsp;</span>BASE64_DATA<span class="Apple-converted-space">&nbsp;</span><span class="sy0">=</span><span class="Apple-converted-space">&nbsp;</span><span class="co2" style="color: rgb(128, 128, 128); ">/^data:.*;base64/i</span><span class="sy0">;</span><br>
    <span class="co1" style="color: rgb(128, 128, 128); ">// path to the PHP module that will decode the encoded data</span><br>
    <span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">var</span><span class="Apple-converted-space">&nbsp;</span>base64Path<span class="Apple-converted-space">&nbsp;</span><span class="sy0">=</span><span class="Apple-converted-space">&nbsp;</span><span class="st0" style="color: rgb(255, 0, 0); ">"/my/path/base64.php"</span><span class="sy0">;</span><br>
    <span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">function</span><span class="Apple-converted-space">&nbsp;</span>fixBase64<span class="br0" style="color: rgb(102, 204, 102); ">(</span>img<span class="br0" style="color: rgb(102, 204, 102); ">)</span><span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">{</span><br>
    &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="co1" style="color: rgb(128, 128, 128); ">// check the image source</span><br>
    &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="kw1" style="color: rgb(161, 161, 0); ">if</span><span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">(</span>BASE64_DATA.<span class="me1">test</span><span class="br0" style="color: rgb(102, 204, 102); ">(</span>img.<span class="me1">src</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span><span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">{</span><br>
    &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="co1" style="color: rgb(128, 128, 128); ">// pass the data to the PHP routine</span><br>
    &nbsp; &nbsp; img.<span class="me1">src</span><span class="Apple-converted-space">&nbsp;</span><span class="sy0">=</span><span class="Apple-converted-space">&nbsp;</span>base64Path<span class="Apple-converted-space">&nbsp;</span><span class="sy0">+</span><span class="Apple-converted-space">&nbsp;</span><span class="st0" style="color: rgb(255, 0, 0); ">"?"</span><span class="Apple-converted-space">&nbsp;</span><span class="sy0">+</span><span class="Apple-converted-space">&nbsp;</span>img.<span class="me1">src</span>.<span class="me1">slice</span><span class="br0" style="color: rgb(102, 204, 102); ">(</span>5<span class="br0" style="color: rgb(102, 204, 102); ">)</span><span class="sy0">;</span><br>
    &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">}</span><br>
    <span class="br0" style="color: rgb(102, 204, 102); ">}</span><span class="sy0">;</span><br>
    <span class="co1" style="color: rgb(128, 128, 128); ">// fix images on page load</span><br>
    <span class="kw3" style="color: rgb(0, 0, 102); ">onload</span><span class="Apple-converted-space">&nbsp;</span><span class="sy0">=</span><span class="Apple-converted-space">&nbsp;</span><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">function</span><span class="br0" style="color: rgb(102, 204, 102); ">(</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span><span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">{</span><br>
    &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="kw1" style="color: rgb(161, 161, 0); ">for</span><span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">(</span><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">var</span><span class="Apple-converted-space">&nbsp;</span>i<span class="Apple-converted-space">&nbsp;</span><span class="sy0">=</span><span class="Apple-converted-space">&nbsp;</span><span class="nu0" style="color: rgb(255, 51, 255); ">0</span><span class="sy0">;</span><span class="Apple-converted-space">&nbsp;</span>i<span class="Apple-converted-space">&nbsp;</span><span class="sy0">&lt;</span><span class="Apple-converted-space">&nbsp;</span>document.<span class="me1">images</span>.<span class="me1">length</span><span class="sy0">;</span><span class="Apple-converted-space">&nbsp;</span>i<span class="sy0">++</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span><span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">{</span><br>
    &nbsp; &nbsp; fixBase64<span class="br0" style="color: rgb(102, 204, 102); ">(</span>document.<span class="me1">images</span><span class="br0" style="color: rgb(102, 204, 102); ">[</span>i<span class="br0" style="color: rgb(102, 204, 102); ">]</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span><span class="sy0">;</span><br>
    &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">}</span><br>
  <span class="br0" style="color: rgb(102, 204, 102); ">}</span><span class="sy0">;</span></div>
</div>
<p style="font-size: 1.05em; ">服务器端的Struts可以参考上面的例子做反向操作，具体从略。</p>
<p style="font-size: 1.05em; "><strong>更完美的方法</strong><br>
  将Base64传回服务器解码是不错的IE6补丁，但是违背了我们的初衷，对IE6来说，浏览器连接数并未有任何减少。更直接的想法，是否能用Javascript直接在浏览器中，对Base64文本进行解码呢？我们构思的场景如下：服务器端先将图片转换成PNG格式以方便客户端进行处理，Base64编码之后，利用JSON将文本传递给浏览器客户端进行处理。</p>
<p style="font-size: 1.05em; ">我们选择PNG图形格式是因为PNG已经俨然成为新的Web图形标准，它格式非常简单，可以很方便的用javascript进行处理而不需要借助浏览器的支持。我们知道javascript直接不能处理二进制数据，但是现在这不是个问题，服务器端已经准备好了Base64编码的文本数据，现在我们只需要一个javascript的Base64解析器，你可以在这里找到一个<a href="http://www.codeproject.com/KB/scripting/Javascript_binaryenc.aspx" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; ">notmasteryet的Base64解析器</a>。</p>
<p style="font-size: 1.05em; ">现在PNG图形格式采用了DEFLATE作为唯一的压缩算法，该算法也广泛应用在ZIP,GZIP等压缩格式中。PNG图像格式文件(或者称为数据流)由一个8字节的PNG文件署名(PNG file signature)域和按照特定结构组织的3个以上的数据块(chunk)组成。</p>
<p style="font-size: 1.05em; ">PNG定义了两种类型的数据块，一种是称为关键数据块(critical chunk)，这是标准的数据块，另一种叫做辅助数据块(ancillary chunks)，这是可选的数据块。关键数据块定义了4个标准数据块，其中图像数据块IDAT(image data chunk)：它存储实际的数据, PNG总的数据流采用DEFLAT进行压缩。此外还擦用三角过滤“delta filters”来过滤每一行的像素的未压缩数据。DEFLAT和delta压缩在其他数据和文本处理中也被广泛应用。PNG格式你可以参考<a href="http://www.libpng.org/pub/png/spec/1.1/PNG-Contents.html" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; ">官方文档</a>。</p>
<p style="font-size: 1.05em; ">很棒的，notmasteryet也为我们提供了一个<a href="http://www.codeproject.com/KB/scripting/Javascript_binaryenc.aspx" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; ">DEFLAT解压器</a>。</p>
<p style="font-size: 1.05em; ">最后，我们把这些组合起来:</p>
<div class="codesnip-container" style="border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-top-color: rgb(204, 204, 204); border-right-color: rgb(204, 204, 204); border-bottom-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: rgb(238, 238, 238); padding-top: 5px; padding-right: 5px; padding-bottom: 5px; padding-left: 5px; margin-top: 10px; margin-right: 10px; margin-bottom: 10px; margin-left: 10px; background-position: initial initial; background-repeat: initial initial; ">
  <div class="html4strict codesnip" style="text-align: left; direction: ltr; font-family: monospace; "><span class="sc0">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</span>
    <p style="font-size: 1.05em; "></p>
    <p style="font-size: 1.05em; "><span class="sc2">&lt;<a href="http://december.com/html/4/element/html.html" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">html</span></a><span class="Apple-converted-space">&nbsp;</span>xmlns<span class="sy0">=</span><span class="st0" style="color: rgb(255, 0, 0); ">"http://www.w3.org/1999/xhtml"</span>&gt;</span><br>
      <span class="sc2">&lt;<a href="http://december.com/html/4/element/head.html" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">head</span></a>&gt;</span><br>
      &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="sc2">&lt;<a href="http://december.com/html/4/element/title.html" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">title</span></a>&gt;</span>Demo JavaScript PNG Viewer<span class="sc2">&lt;<span class="sy0">/</span><a href="http://december.com/html/4/element/title.html" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">title</span></a>&gt;</span><br>
      &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="sc2">&lt;<a href="http://december.com/html/4/element/style.html" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">style</span></a><span class="Apple-converted-space">&nbsp;</span><span class="kw3" style="color: rgb(0, 0, 102); ">type</span><span class="sy0">=</span><span class="st0" style="color: rgb(255, 0, 0); ">"text/css"</span>&gt;</span><br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .pixel {<br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; width: 1px;<br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; height: 1px;<br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; float: left;<br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; overflow: hidden;<br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #nativeimage {<br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; position: absolute;<br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; left: 10px;<br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; top: 112px;<br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #image {<br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; position: absolute;<br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; left: 10px;<br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; top: 10px;<br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #largeimage {<br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; position: absolute;<br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; border: 1px solid #000;<br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; top: 10px;<br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; left: 100px;<br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #largeimage .pixel {<br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; width: 3px;<br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; height: 3px;<br>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>
      &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="sc2">&lt;<span class="sy0">/</span><a href="http://december.com/html/4/element/style.html" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">style</span></a>&gt;</span><br>
      &nbsp;<span class="sc2">&lt;<span class="sy0">/</span><a href="http://december.com/html/4/element/head.html" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">head</span></a>&gt;</span><br>
      <span class="sc2">&lt;<a href="http://december.com/html/4/element/body.html" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">body</span></a><span class="Apple-converted-space">&nbsp;</span><span class="kw3" style="color: rgb(0, 0, 102); ">onload</span><span class="sy0">=</span><span class="st0" style="color: rgb(255, 0, 0); ">"show(gravatar);"</span>&gt;</span><br>
      <span class="sc2">&lt;<a href="http://december.com/html/4/element/script.html" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">script</span></a><span class="Apple-converted-space">&nbsp;</span><span class="kw3" style="color: rgb(0, 0, 102); ">src</span><span class="sy0">=</span><span class="st0" style="color: rgb(255, 0, 0); ">"../Source/Base64.js"</span><span class="Apple-converted-space">&nbsp;</span><span class="kw3" style="color: rgb(0, 0, 102); ">type</span><span class="sy0">=</span><span class="st0" style="color: rgb(255, 0, 0); ">"text/javascript"</span>&gt;&lt;<span class="sy0">/</span><a href="http://december.com/html/4/element/script.html" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">script</span></a>&gt;</span><br>
      <span class="sc2">&lt;<a href="http://december.com/html/4/element/script.html" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">script</span></a><span class="Apple-converted-space">&nbsp;</span><span class="kw3" style="color: rgb(0, 0, 102); ">src</span><span class="sy0">=</span><span class="st0" style="color: rgb(255, 0, 0); ">"../Source/Deflate.js"</span><span class="Apple-converted-space">&nbsp;</span><span class="kw3" style="color: rgb(0, 0, 102); ">type</span><span class="sy0">=</span><span class="st0" style="color: rgb(255, 0, 0); ">"text/javascript"</span>&gt;&lt;<span class="sy0">/</span><a href="http://december.com/html/4/element/script.html" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">script</span></a>&gt;</span><br>
    <span class="sc2">&lt;<a href="http://december.com/html/4/element/script.html" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">script</span></a><span class="Apple-converted-space">&nbsp;</span><span class="kw3" style="color: rgb(0, 0, 102); ">src</span><span class="sy0">=</span><span class="st0" style="color: rgb(255, 0, 0); ">"../Source/PNG.js"</span><span class="Apple-converted-space">&nbsp;</span><span class="kw3" style="color: rgb(0, 0, 102); ">type</span><span class="sy0">=</span><span class="st0" style="color: rgb(255, 0, 0); ">"text/javascript"</span>&gt;&lt;<span class="sy0">/</span><a href="http://december.com/html/4/element/script.html" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">script</span></a>&gt;</span></p>
    <p style="font-size: 1.05em; "><span class="sc2">&lt;<a href="http://december.com/html/4/element/script.html" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">script</span></a><span class="Apple-converted-space">&nbsp;</span><span class="kw3" style="color: rgb(0, 0, 102); ">type</span><span class="sy0">=</span><span class="st0" style="color: rgb(255, 0, 0); ">"text/javascript"</span>&gt;</span><br>
      var gravatar = ‘iVBORw0KGgoAAAANSUhEUgAAA…….数据从略……55CYII=’;<br>
      String.prototype.padRight = function(c, n){<br>
      &nbsp; &nbsp; &nbsp; &nbsp; var txt = ”;<br>
      &nbsp; &nbsp; &nbsp; &nbsp; for(var i=0;i<span class="sc2">&lt;n-this.length;i++<span class="br0" style="color: rgb(102, 204, 102); ">)</span><span class="Apple-converted-space">&nbsp;</span>txt +<span class="sy0">=</span><span class="Apple-converted-space">&nbsp;</span>c;</span><br>
      <span class="sc2">&nbsp; &nbsp; &nbsp; &nbsp; return txt + this;</span><br>
      <span class="sc2"><span class="br0" style="color: rgb(102, 204, 102); ">}</span>;</span><br>
      <span class="sc2">function show<span class="br0" style="color: rgb(102, 204, 102); ">(</span><span class="kw3" style="color: rgb(0, 0, 102); ">data</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span><span class="br0" style="color: rgb(102, 204, 102); ">{</span></span><br>
      <span class="sc2">&nbsp; &nbsp; &nbsp; &nbsp; var png<span class="Apple-converted-space">&nbsp;</span><span class="sy0">=</span><span class="Apple-converted-space">&nbsp;</span>new PNG<span class="br0" style="color: rgb(102, 204, 102); ">(</span><span class="kw3" style="color: rgb(0, 0, 102); ">data</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span>;</span><br>
      <span class="sc2">&nbsp; &nbsp; &nbsp; &nbsp; var img<span class="Apple-converted-space">&nbsp;</span><span class="sy0">=</span><span class="Apple-converted-space">&nbsp;</span>document.getElementById<span class="br0" style="color: rgb(102, 204, 102); ">(</span><span class="st0" style="color: rgb(255, 0, 0); ">‘image’</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span>, limg<span class="Apple-converted-space">&nbsp;</span><span class="sy0">=</span><span class="Apple-converted-space">&nbsp;</span>document.getElementById<span class="br0" style="color: rgb(102, 204, 102); ">(</span><span class="st0" style="color: rgb(255, 0, 0); ">‘largeimage’</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span>;</span><br>
      <span class="sc2">&nbsp; &nbsp; &nbsp; &nbsp; document.getElementById<span class="br0" style="color: rgb(102, 204, 102); ">(</span><span class="st0" style="color: rgb(255, 0, 0); ">‘nativeimage’</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span>.<span class="kw3" style="color: rgb(0, 0, 102); ">src</span><span class="Apple-converted-space">&nbsp;</span><span class="sy0">=</span><span class="Apple-converted-space">&nbsp;</span><span class="st0" style="color: rgb(255, 0, 0); ">‘data:image/png;base64,’</span><span class="Apple-converted-space">&nbsp;</span>+<span class="Apple-converted-space">&nbsp;</span><span class="kw3" style="color: rgb(0, 0, 102); ">data</span>;</span><br>
      <span class="sc2">&nbsp; &nbsp; &nbsp; &nbsp; img.innerHTML<span class="Apple-converted-space">&nbsp;</span><span class="sy0">=</span><span class="Apple-converted-space">&nbsp;</span><span class="st0" style="color: rgb(255, 0, 0); ">”</span>;</span><br>
      <span class="sc2">&nbsp; &nbsp; &nbsp; &nbsp; limg.innerHTML<span class="Apple-converted-space">&nbsp;</span><span class="sy0">=</span><span class="Apple-converted-space">&nbsp;</span><span class="st0" style="color: rgb(255, 0, 0); ">”</span>;</span><br>
      <span class="sc2">&nbsp; &nbsp; &nbsp; &nbsp; img.<span class="kw3" style="color: rgb(0, 0, 102); ">style</span>.<span class="kw3" style="color: rgb(0, 0, 102); ">width</span><span class="Apple-converted-space">&nbsp;</span><span class="sy0">=</span><span class="Apple-converted-space">&nbsp;</span>png.<span class="kw3" style="color: rgb(0, 0, 102); ">width</span><span class="Apple-converted-space">&nbsp;</span>+<span class="Apple-converted-space">&nbsp;</span><span class="st0" style="color: rgb(255, 0, 0); ">‘px’</span>;</span><br>
      <span class="sc2">&nbsp; &nbsp; &nbsp; &nbsp; img.<span class="kw3" style="color: rgb(0, 0, 102); ">style</span>.<span class="kw3" style="color: rgb(0, 0, 102); ">height</span><span class="Apple-converted-space">&nbsp;</span><span class="sy0">=</span><span class="Apple-converted-space">&nbsp;</span>png.<span class="kw3" style="color: rgb(0, 0, 102); ">height</span><span class="Apple-converted-space">&nbsp;</span>+<span class="Apple-converted-space">&nbsp;</span><span class="st0" style="color: rgb(255, 0, 0); ">‘px’</span>;</span><br>
      <span class="sc2">&nbsp; &nbsp; &nbsp; &nbsp; limg.<span class="kw3" style="color: rgb(0, 0, 102); ">style</span>.<span class="kw3" style="color: rgb(0, 0, 102); ">width</span><span class="Apple-converted-space">&nbsp;</span><span class="sy0">=</span><span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">(</span>png.<span class="kw3" style="color: rgb(0, 0, 102); ">width</span><span class="Apple-converted-space">&nbsp;</span>*<span class="Apple-converted-space">&nbsp;</span><span class="nu0" style="color: rgb(255, 51, 255); ">3</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span><span class="Apple-converted-space">&nbsp;</span>+<span class="Apple-converted-space">&nbsp;</span><span class="st0" style="color: rgb(255, 0, 0); ">‘px’</span>;</span><br>
      <span class="sc2">&nbsp; &nbsp; &nbsp; &nbsp; limg.<span class="kw3" style="color: rgb(0, 0, 102); ">style</span>.<span class="kw3" style="color: rgb(0, 0, 102); ">width</span><span class="Apple-converted-space">&nbsp;</span><span class="sy0">=</span><span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">(</span>png.<span class="kw3" style="color: rgb(0, 0, 102); ">height</span><span class="Apple-converted-space">&nbsp;</span>*<span class="Apple-converted-space">&nbsp;</span><span class="nu0" style="color: rgb(255, 51, 255); ">3</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span><span class="Apple-converted-space">&nbsp;</span>+<span class="Apple-converted-space">&nbsp;</span><span class="st0" style="color: rgb(255, 0, 0); ">‘px’</span>;</span><br>
      <span class="sc2">&nbsp; &nbsp; &nbsp; &nbsp; var line;</span><br>
      <span class="sc2">&nbsp; &nbsp; &nbsp; &nbsp; while<span class="br0" style="color: rgb(102, 204, 102); ">(</span>line<span class="Apple-converted-space">&nbsp;</span><span class="sy0">=</span><span class="Apple-converted-space">&nbsp;</span>png.readLine<span class="br0" style="color: rgb(102, 204, 102); ">(</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span></span><br>
      <span class="sc2">&nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">{</span></span><br>
      <span class="sc2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="kw3" style="color: rgb(0, 0, 102); ">for</span><span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">(</span>var x<span class="Apple-converted-space">&nbsp;</span><span class="sy0">=</span><span class="Apple-converted-space">&nbsp;</span><span class="nu0" style="color: rgb(255, 51, 255); ">0</span>; x &lt; line.length; x++<span class="br0" style="color: rgb(102, 204, 102); ">)</span><span class="br0" style="color: rgb(102, 204, 102); ">{</span></span><br>
      <span class="sc2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var px<span class="Apple-converted-space">&nbsp;</span><span class="sy0">=</span><span class="Apple-converted-space">&nbsp;</span>document.createElement<span class="br0" style="color: rgb(102, 204, 102); ">(</span><span class="st0" style="color: rgb(255, 0, 0); ">‘div’</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span>, px2<span class="Apple-converted-space">&nbsp;</span><span class="sy0">=</span>document.createElement<span class="br0" style="color: rgb(102, 204, 102); ">(</span><span class="st0" style="color: rgb(255, 0, 0); ">‘div’</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span>;</span><br>
      <span class="sc2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; px.className<span class="Apple-converted-space">&nbsp;</span><span class="sy0">=</span><span class="Apple-converted-space">&nbsp;</span>px2.className<span class="Apple-converted-space">&nbsp;</span><span class="sy0">=</span><span class="Apple-converted-space">&nbsp;</span><span class="st0" style="color: rgb(255, 0, 0); ">‘pixel’</span>;</span><br>
      <span class="sc2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; px.<span class="kw3" style="color: rgb(0, 0, 102); ">style</span>.backgroundColor<span class="Apple-converted-space">&nbsp;</span><span class="sy0">=</span><span class="Apple-converted-space">&nbsp;</span>px2.<span class="kw3" style="color: rgb(0, 0, 102); ">style</span>.backgroundColor<span class="Apple-converted-space">&nbsp;</span><span class="sy0">=</span><span class="Apple-converted-space">&nbsp;</span><span class="st0" style="color: rgb(255, 0, 0); ">‘#’</span><span class="Apple-converted-space">&nbsp;</span>+ line<span class="br0" style="color: rgb(102, 204, 102); ">[</span>x<span class="br0" style="color: rgb(102, 204, 102); ">]</span>.toString<span class="br0" style="color: rgb(102, 204, 102); ">(</span><span class="nu0" style="color: rgb(255, 51, 255); ">16</span><span class="br0" style="color: rgb(102, 204, 102); ">)</span>.padRight<span class="br0" style="color: rgb(102, 204, 102); ">(</span><span class="st0" style="color: rgb(255, 0, 0); ">’0′</span>, 6<span class="br0" style="color: rgb(102, 204, 102); ">)</span>;</span><br>
      <span class="sc2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; img.appendChild<span class="br0" style="color: rgb(102, 204, 102); ">(</span>px<span class="br0" style="color: rgb(102, 204, 102); ">)</span>;</span><br>
      <span class="sc2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; limg.appendChild<span class="br0" style="color: rgb(102, 204, 102); ">(</span>px2<span class="br0" style="color: rgb(102, 204, 102); ">)</span>;</span><br>
      <span class="sc2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">}</span></span><br>
      <span class="sc2">&nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-converted-space">&nbsp;</span><span class="br0" style="color: rgb(102, 204, 102); ">}</span></span><br>
      <span class="sc2"><span class="br0" style="color: rgb(102, 204, 102); ">}</span></span><br>
      <span class="sc2">&lt;<span class="sy0">/</span><a href="http://december.com/html/4/element/script.html" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">script</span></a>&gt;</span><br>
      <span class="sc2">&lt;<a href="http://december.com/html/4/element/div.html" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">div</span></a><span class="Apple-converted-space">&nbsp;</span><span class="kw3" style="color: rgb(0, 0, 102); ">id</span><span class="sy0">=</span><span class="st0" style="color: rgb(255, 0, 0); ">"image"</span>&gt;&lt;<span class="sy0">/</span><a href="http://december.com/html/4/element/div.html" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">div</span></a>&gt;</span><br>
      <span class="sc2">&lt;<a href="http://december.com/html/4/element/div.html" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">div</span></a><span class="Apple-converted-space">&nbsp;</span><span class="kw3" style="color: rgb(0, 0, 102); ">id</span><span class="sy0">=</span><span class="st0" style="color: rgb(255, 0, 0); ">"largeimage"</span>&gt;&lt;<span class="sy0">/</span><a href="http://december.com/html/4/element/div.html" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">div</span></a>&gt;</span><br>
      <span class="sc2">&lt;<a href="http://december.com/html/4/element/img.html" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">img</span></a><span class="Apple-converted-space">&nbsp;</span><span class="kw3" style="color: rgb(0, 0, 102); ">id</span><span class="sy0">=</span><span class="st0" style="color: rgb(255, 0, 0); ">"nativeimage"</span><span class="Apple-converted-space">&nbsp;</span><span class="sy0">/</span>&gt;</span><br>
      <span class="sc2">&lt;<span class="sy0">/</span><a href="http://december.com/html/4/element/body.html" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">body</span></a>&gt;</span><br>
    <span class="sc2">&lt;<span class="sy0">/</span><a href="http://december.com/html/4/element/html.html" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; "><span class="kw2" style="color: rgb(0, 0, 0); font-weight: bold; ">html</span></a>&gt;</span></p>
  </div>
</div>
<p style="font-size: 1.05em; ">相关的javascript可以在这里下载：<a href="http://blogs.ejb.cc/wp-content/uploads/2010/10/javascript_png_deflate.zip" style="text-decoration: underline; font-weight: normal; color: rgb(70, 104, 142); outline-style: none; outline-width: initial; outline-color: initial; ">javascript_png_deflate</a></p>
<p style="font-size: 1.05em; "><strong>还可以更完美</strong><br>
  回顾上一篇的例子，我们用了ihard.net提供了Base64编码，它提供一个GZIP编码参数，你可以发现如此编码之后的文本大小和原来的图形大小相差无几。利用上一节提供了javascript是不是可以解决Base64编码后文件大小增加的问题？留着思考吧。</p>
</span></span> 
<!--EndFragment-->
</body>
</htm>
