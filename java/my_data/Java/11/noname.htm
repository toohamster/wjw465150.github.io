<!-- saved from url=http://cache.baidu.com/c?word=jtidy&url=http%3A//www%2Ecnblogs%2Ecom/haogj/archive/2007/03/15/339143%2Ehtml&p=903fda15d9c545f30be2957c564d83&user=baidu -->
<script>
window.onerror = new Function("return(false);")
</script><!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<HTML>
<HEAD>
<TITLE>使用 JTidy 协助抽取网页内容</TITLE>
<FORM action=http://www.baidu.com/s>
</HEAD>

<BODY>
<!--StartFragment-->
<TABLE cellPadding=0 width="100%" bgColor=#ffffff border=0>
  <TBODY>
    <TR>
      <TD width=254><A href="http://www.baidu.com/"><IMG alt=到百度首页 
src="logo-kz.gif" border=0></A></TD>
      <TD><FONT color=black size=-1>
        <INPUT 
style="FONT-SIZE: 16px; FONT-FAMILY: Verdana,Arial,Helvetica,sans-serif" size=30 
name=wd>
        <INPUT type=submit value=百度一下>
        </FONT></TD>
    </TR>
    <TR>
      <TD colSpan=2><FONT color=black size=-1>您的查询字词都已标明如下：<B 
style="COLOR: black; BACKGROUND-COLOR: #ffff66"><A 
href="http://cache.baidu.com/c?word=jtidy&amp;url=http%3A//www%2Ecnblogs%2Ecom/haogj/archive/2007/03/15/339143%2Ehtml&amp;p=903fda15d9c545f30be2957c564d83&amp;user=baidu#baidusnap0">jtidy</A>&nbsp;</B> (点击查询词，可以跳到它在文中首次出现的位置) <BR>
        如果打开速度慢，您可以尝试打开<A 
href="http://cache.baidu.com/c?word=jtidy&amp;url=http%3A//www%2Ecnblogs%2Ecom/haogj/archive/2007/03/15/339143%2Ehtml&amp;p=903fda15d9c545f30be2957c564d83&amp;user=baidu&amp;im=0"><FONT 
style="TEXT-DECORATION: underline" color=blue>无图片的快照</FONT></A>； 如果您想保存该页面，可以<A 
onclick="window.open('http://cang.baidu.com/do/add?it='+encodeURIComponent(document.title)+'&amp;iu='+encodeURIComponent(location.href)+'&amp;fr=ps#nw=1','_s','scrollbars=no,width=600,height=450,right=75,top=20,status=no,resizable=yes'); return false;" 
href="add" target=_blank><FONT 
style="TEXT-DECORATION: underline" color=blue>添加到搜藏</FONT></A><BR>
        <FONT 
color=gray>(百度和网页<A 
href="http://www.cnblogs.com/haogj/archive/2007/03/15/339143.html"><FONT 
color=blue>http://www.cnblogs.com/haogj/archive/2007/03/15/339143.html</FONT></A>的作者无关，不对其内容负责。百度快照谨为网络故障时之索引，不代表被搜索网站的即时页面。)</FONT></FONT></TD>
    </TR>
  </TBODY>
</TABLE>
</FORM>
<HR>
<META id=metaKeywords content="使用 JTidy 协助抽取网页内容 " name=keywords>
<LINK 
id=MainCss href="style.css" 
type=text/css rel=stylesheet>
<LINK id=RSSLink title=RSS 
href="rss.aspx" type=application/rss+xml 
rel=alternate>
<FORM id=Form1 name=Form1 action=339143.html method=post>
  <INPUT 
id="&#13;&#10;__VIEWSTATE" type=hidden name=__VIEWSTATE>
  <DIV id=maincontainer>
    <DIV id=header>
      <H1><A class=headermaintitle id=Header1_HeaderTitle 
href="http://www.cnblogs.com/haogj/">haogj</A></H1>
      <DIV id=tagline></DIV>
      <DIV id=menubar>
        <DIV id=blogstats><SPAN>posts(5)</SPAN> <SPAN>comments(5)</SPAN> <SPAN>trackbacks(0)</SPAN> </DIV>
        <UL>
          <LI><A class=home id=Header1_MyLinks1_HomeLink 
href="http://www.cnblogs.com/">博客园</A>
          <LI><A class=contact id=Header1_MyLinks1_ContactLink accessKey=9 
href="http://www.cnblogs.com/haogj/contact.aspx?id=1">联系</A>
          <LI><A id=Header1_MyLinks1_XMLLink href="rss"><IMG 
alt="RSS 2.0 Feed" src="xml.gif" border=0></A>&nbsp;<A 
id=Header1_MyLinks1_Syndication href="http://www.cnblogs.com/haogj/rss">聚合</A>
          <LI><A class=admin id=Header1_MyLinks1_Admin 
href="http://www.cnblogs.com/haogj/admin/EditPosts.aspx">管理</A> </LI>
        </UL>
      </DIV>
    </DIV>
    <DIV id=content>
      <DIV id=left style="DISPLAY: none">
        <DIV class=container>
          <DIV class=containerheader>
            <H3>常用链接</H3>
          </DIV>
          <DIV class=containercontent>
            <UL>
              <LI><A id=SingleColumn_ctl00_repeaterLinks_ctl01_lnkLinkItem 
href="http://www.cnblogs.com/haogj/MyPosts.html">我的随笔</A>
              <LI><A id=SingleColumn_ctl00_repeaterLinks_ctl02_lnkLinkItem 
href="http://www.cnblogs.com/haogj/MyComments.html">我的评论</A>
              <LI><A id=SingleColumn_ctl00_repeaterLinks_ctl03_lnkLinkItem 
href="http://www.cnblogs.com/haogj/OtherPosts.html">我参与的随笔</A> </LI>
            </UL>
          </DIV>
        </DIV>
        <DIV class=container>
          <DIV class=containerheader>
            <H3>留言簿</H3>
          </DIV>
          <DIV class=containercontent>
            <UL>
              <LI><A id=SingleColumn__46ff53f8a38_lnkMessages>给我留言</A>
              <LI><A id=SingleColumn__46ff53f8a38_lnkPublicMsgView>查看公开留言</A>
              <LI><A id=SingleColumn__46ff53f8a38_lnkPrivateMsgView>查看私人留言</A> </LI>
            </UL>
          </DIV>
        </DIV>
        <DIV class=container>
          <DIV class=containerheader>
            <H3>随笔分类</H3>
          </DIV>
          <UL class=containercontent>
            <LI><A class=rsslink 
id=SingleColumn_Categories_CatList_ctl00_LinkList_ctl01_RssLink 
title="Subscribe to .Net(2)" 
href="http://www.cnblogs.com/haogj/category/49467.html/rss"></A><A 
id=SingleColumn_Categories_CatList_ctl00_LinkList_ctl01_Link 
href="49467.html">.Net(2)</A>
            <LI><A class=rsslink 
id=SingleColumn_Categories_CatList_ctl00_LinkList_ctl02_RssLink 
title="Subscribe to XML(2)" 
href="http://www.cnblogs.com/haogj/category/49468.html/rss"></A><A 
id=SingleColumn_Categories_CatList_ctl00_LinkList_ctl02_Link 
href="49468.html">XML(2)</A> </LI>
          </UL>
          <DIV class=containerfooter></DIV>
        </DIV>
        <DIV class=container>
          <DIV class=containerheader>
            <H3>随笔档案</H3>
          </DIV>
          <UL class=containercontent>
            <LI><A id=SingleColumn_Categories_CatList_ctl01_LinkList_ctl01_Link 
href="09.html">2006年9月 (1)</A>
            <LI><A id=SingleColumn_Categories_CatList_ctl01_LinkList_ctl02_Link 
href="02.html">2006年2月 (4)</A> </LI>
          </UL>
          <DIV class=containerfooter></DIV>
        </DIV>
        <DIV class=container>
          <DIV class=containerheader>
            <H3>Java</H3>
          </DIV>
          <UL class=containercontent>
            <LI><A id=SingleColumn_Categories_CatList_ctl02_LinkList_ctl01_Link 
href="http://www.blogjava.net/haogj/">Java的天空</A> </LI>
          </UL>
          <DIV class=containerfooter></DIV>
        </DIV>
        <H3>搜索</H3>
        <UL>
          <LI>
          <LI>
            <INPUT id=q 
onkeydown="return SearchGoogle(document.getElementById('q'),event,'http://www.cnblogs.com/haogj/')" 
style="WIDTH: 130px" name=q>
            &nbsp;
            <INPUT onclick="SearchGoogle(document.getElementById('q'),event,'http://www.cnblogs.com/haogj/')" type=button value=搜索 name=sa>
          </LI>
        </UL>
        <DIV class=container>
          <DIV class=containerheader>
            <H3>最新评论 <A id=SingleColumn__32dbad361fa5_RSSHyperlink1 
href="http://www.cnblogs.com/haogj/CommentsRSS.aspx"><IMG src="xml.gif" 
border=0></A></H3>
          </DIV>
          <UL class=containercontent style="WIDTH: 100%; WORD-BREAK: break-all">
            <LI style="WORD-BREAK: break-all"><A name=baidusnap0></A><A 
id=SingleColumn__32dbad361fa5_CommentList_ctl01_Hyperlink1 
href="http://www.cnblogs.com/haogj/archive/2007/03/15/339143.html#675604">1.?re: 
              使用 <B style="COLOR: black; BACKGROUND-COLOR: #ffff66">JTidy</B> 协助抽取网页内容 </A>
            <LI style="WORD-BREAK: break-all">评论内容较长,点击标题查看
            <LI style="MARGIN-RIGHT: 4px; TEXT-ALIGN: right">--xiaolang
            <LI style="WORD-BREAK: break-all"><A 
id=SingleColumn__32dbad361fa5_CommentList_ctl02_Hyperlink1 
href="http://www.cnblogs.com/haogj/archive/2006/05/22/338026.html#406322">2.?re: 
              关于 OpenSmtp 邮件标题过长后出现乱码问题的解决</A>
            <LI style="WORD-BREAK: break-all">好东西， 解决了我用的乱码问题， 谢谢！ <BR>
            <LI style="MARGIN-RIGHT: 4px; TEXT-ALIGN: right">--蓦然回首
            <LI style="WORD-BREAK: break-all"><A 
id=SingleColumn__32dbad361fa5_CommentList_ctl03_Hyperlink1 
href="http://www.cnblogs.com/haogj/archive/2006/02/27/338026.html#338423">3.?re: 
              关于 OpenSmtp 邮件标题过长后出现乱码问题的解决</A>
            <LI style="WORD-BREAK: break-all">谢谢分享
            <LI style="MARGIN-RIGHT: 4px; TEXT-ALIGN: right">--开心糊涂
            <LI style="WORD-BREAK: break-all"><A 
id=SingleColumn__32dbad361fa5_CommentList_ctl04_Hyperlink1 
href="http://www.cnblogs.com/haogj/archive/2006/02/26/338026.html#338044">4.?re: 
              关于 OpenSmtp 邮件标题过长后出现乱码问题的解决</A>
            <LI 
style="WORD-BREAK: break-all">文章很实用,收藏起来先,同意一楼的,这种文章标题很明确,需要的人一定会点击进去的,太长时用摘要可以审空间,大家构建高质量的博客园,这是博客需要的精神
            <LI style="MARGIN-RIGHT: 4px; TEXT-ALIGN: right">--郭胜群
            <LI style="WORD-BREAK: break-all"><A 
id=SingleColumn__32dbad361fa5_CommentList_ctl05_Hyperlink1 
href="http://www.cnblogs.com/haogj/archive/2006/02/26/338026.html#338041">5.?re: 
              关于 OpenSmtp 邮件标题过长后出现乱码问题的解决</A>
            <LI style="WORD-BREAK: break-all">建议使用摘要方式发布。
            <LI style="MARGIN-RIGHT: 4px; TEXT-ALIGN: right">--dudu </LI>
          </UL>
        </DIV>
        <DIV class=container>
          <DIV class=containerheader>
            <H3>阅读排行榜</H3>
          </DIV>
        </DIV>
        <DIV class=container>
          <DIV class=containerheader>
            <H3>评论排行榜</H3>
          </DIV>
        </DIV>
      </DIV>
      <DIV id=right>
        <DIV class=container>
          <DIV class=containerheader>
            <H3>View Post</H3>
          </DIV>
          <DIV class=containercontent>
            <DIV class=post>
              <H2><A id=viewpost1_TitleUrl 
href="http://www.cnblogs.com/haogj/archive/2006/02/27/JTidy.html">使用 <B 
style="COLOR: black; BACKGROUND-COLOR: #ffff66">JTidy</B> 协助抽取网页内容 </A></H2>
              <DIV>Tidy 是 W3C 用来解析网页的一个软件包，可以方便地将 HTML 文档转换为符合 XML 标准的文档，由于 XML 可以方便地使用 XSLT 
                技术对内容进行抽取，所以使用 Tidy 配合 XSLT 可以方便地将各种网页的内容抽取出来，保存成我们需要的格式。</DIV>
              <DIV>通过 <B style="COLOR: black; BACKGROUND-COLOR: #ffff66">JTidy</B> 可以方便地将标准的 
                HTML 网页转换为 XML 的 DOM 对象，然后，通过 XPaht 和 XSLT 将需要的内容抽取出来。</DIV>
              <DIV>&nbsp;</DIV>
              <DIV>使用 <B style="COLOR: black; BACKGROUND-COLOR: #ffff66">JTidy</B> 抽取网页内容的代码如下：</DIV>
              <DIV>&nbsp;</DIV>
              <DIV>package com.tsinghua;</DIV>
              <DIV>import java.io.File;<BR>
                import java.io.FileInputStream;<BR>
                import 
                java.io.FileOutputStream;<BR>
                import java.io.IOException;<BR>
                import 
                java.io.InputStreamReader;<BR>
                import java.io.OutputStreamWriter;<BR>
                import 
                java.util.logging.Level;<BR>
                import java.util.logging.Logger;</DIV>
              <DIV>import javax.xml.parsers.DocumentBuilder;<BR>
                import 
                javax.xml.parsers.DocumentBuilderFactory;<BR>
                import 
                javax.xml.parsers.ParserConfigurationException;<BR>
                import 
                javax.xml.transform.Result;<BR>
                import javax.xml.transform.Source;<BR>
                import 
                javax.xml.transform.Templates;<BR>
                import 
                javax.xml.transform.Transformer;<BR>
                import 
                javax.xml.transform.TransformerConfigurationException;<BR>
                import 
                javax.xml.transform.TransformerException;<BR>
                import 
                javax.xml.transform.TransformerFactory;<BR>
                import 
                javax.xml.transform.dom.DOMSource;<BR>
                import 
                javax.xml.transform.stream.StreamResult;<BR>
                import 
                javax.xml.transform.stream.StreamSource;</DIV>
              <DIV>import org.w3c.dom.Document;<BR>
                import org.w3c.dom.Element;<BR>
                import 
                org.w3c.dom.Node;<BR>
                import org.w3c.dom.NodeList;<BR>
                import 
                org.w3c.tidy.Configuration;<BR>
                import org.w3c.tidy.Tidy;<BR>
                import 
                org.xml.sax.SAXException;</DIV>
              <DIV>public class HTMLParserByW3CDOM {<BR>
                &nbsp;private Templates 
                template;<BR>
                &nbsp;/*<BR>
                &nbsp; * 解析网页<BR>
                &nbsp; * XSLTFileName&nbsp;用于解析网页的样式表文件名<BR>
                &nbsp; * 
                HTMLFileName 待解析的网页文件名<BR>
                &nbsp; * OutputFileName 输出文件名<BR>
                &nbsp; */<BR>
                &nbsp;public void 
                parser(String HTMLFileName, String OutputFileName)<BR>
                &nbsp;{<BR>
                &nbsp;&nbsp;if( this.template 
                != null){<BR>
                &nbsp;&nbsp;&nbsp;Document doc =&nbsp; this.HTMLToXML( HTMLFileName );&nbsp;// 解析网页，返回 W3c 
                Document 文档对象 <BR>
                &nbsp;&nbsp;&nbsp;Transformer(doc, OutputFileName);&nbsp;&nbsp;&nbsp;&nbsp;// 使用样式表转换 Document 
                为最终结果<BR>
                &nbsp;&nbsp;}<BR>
                &nbsp;}<BR>
                &nbsp;<BR>
                &nbsp;/**<BR>
                &nbsp; * 解析网页，转换为 W3C Document 文档对象<BR>
                &nbsp; * @param 
                fileName&nbsp;HTML 网页的文件名<BR>
                &nbsp; * @return&nbsp;&nbsp;&nbsp;utf-8 W3C Document 文档对象<BR>
                &nbsp; 
                */<BR>
                &nbsp;private Document HTMLToXML(String fileName) {<BR>
                &nbsp;&nbsp;Logger log = 
                Logger.getLogger("HTMLToXML");<BR>
                &nbsp;&nbsp;Document doc = 
                null;<BR>
                &nbsp;&nbsp;try{<BR>
                &nbsp;&nbsp;&nbsp;FileInputStream in = new FileInputStream( fileName );&nbsp;// 
                打开文件，转换为 UTF-8 编码&nbsp; <BR>
                &nbsp;&nbsp;&nbsp;InputStreamReader isr = new InputStreamReader(in, 
                "GB2312");&nbsp;// 源文件编码为 gb2312<BR>
                &nbsp;&nbsp;&nbsp;<BR>
                &nbsp;&nbsp;&nbsp;File tmpNewFile = 
                File.createTempFile("GB2312",".html");&nbsp;// 转换后的文件，设定编码为 
                utf-8<BR>
                &nbsp;&nbsp;&nbsp;FileOutputStream out = new FileOutputStream( tmpNewFile );&nbsp;// 
                需要将文件转换为字符流<BR>
                &nbsp;&nbsp;&nbsp;OutputStreamWriter osw = new OutputStreamWriter( out , 
                "UTF-8");// 指定目标编码为 utf-8<BR>
                &nbsp;&nbsp;&nbsp;osw.write("&lt;?xml version=\"1.0\" 
                encoding=\"utf-8\"?&gt;\n");<BR>
                &nbsp;&nbsp;&nbsp;<BR>
                &nbsp;&nbsp;&nbsp;char[] buffer = new 
                char[10240];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 文件缓冲区<BR>
                &nbsp;&nbsp;&nbsp;int len = 0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 
                使用字符读取方式，循环读取源文件内容<BR>
                &nbsp;&nbsp;&nbsp;while( (len = isr.read(buffer)) !=-1 )&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 
                转换后写入目标文件中<BR>
                &nbsp;&nbsp;&nbsp;{<BR>
                &nbsp;&nbsp;&nbsp;&nbsp;osw.write( buffer, 0, 
                len);<BR>
                &nbsp;&nbsp;&nbsp;}<BR>
                &nbsp;&nbsp;&nbsp;osw.close();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 
                转换完成<BR>
                &nbsp;&nbsp;&nbsp;isr.close();<BR>
                &nbsp;&nbsp;&nbsp;out.close();<BR>
                &nbsp;&nbsp;&nbsp;in.close();<BR>
                &nbsp;&nbsp;&nbsp;<BR>
                &nbsp;&nbsp;&nbsp;if( 
                log.isLoggable( Level.INFO)){<BR>
                &nbsp;&nbsp;&nbsp;&nbsp;log.info("HTML 文档转 UTF-8 
                编码完成！");<BR>
                &nbsp;&nbsp;&nbsp;}<BR>
                &nbsp;&nbsp;&nbsp;<BR>
                &nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;设置 tidy ，准备转换<BR>
                &nbsp;&nbsp;&nbsp;Tidy tidy = new 
                Tidy();<BR>
                &nbsp;&nbsp;&nbsp;tidy.setXmlOut(true);&nbsp;&nbsp;&nbsp;&nbsp;// 输出格式 
                xml<BR>
                &nbsp;&nbsp;&nbsp;tidy.setDropFontTags(true);&nbsp;&nbsp;&nbsp;// 
                删除字体节点<BR>
                &nbsp;&nbsp;&nbsp;tidy.setDropEmptyParas(true);&nbsp;&nbsp;// 
                删除空段落<BR>
                &nbsp;&nbsp;&nbsp;tidy.setFixComments(true);&nbsp;&nbsp;&nbsp;// 
                修复注释<BR>
                &nbsp;&nbsp;&nbsp;tidy.setFixBackslash(true);&nbsp;&nbsp;&nbsp;// 
                修复反斜杆<BR>
                &nbsp;&nbsp;&nbsp;tidy.setMakeClean(true);&nbsp;&nbsp;&nbsp;// 
                删除混乱的表示<BR>
                &nbsp;&nbsp;&nbsp;tidy.setQuoteNbsp(false);&nbsp;&nbsp;&nbsp;// 将空格输出为 &amp;nbsp; <BR>
                &nbsp;&nbsp;&nbsp;tidy.setQuoteMarks(false);&nbsp;&nbsp;&nbsp;// 将双引号输出为 
                &amp;quot;<BR>
                &nbsp;&nbsp;&nbsp;tidy.setQuoteAmpersand(true);&nbsp;&nbsp;// 将 &amp;amp; 输出为 
                &amp;<BR>
                &nbsp;&nbsp;&nbsp;tidy.setShowWarnings(false);&nbsp;&nbsp;// 
                不显示警告信息<BR>
                &nbsp;&nbsp;&nbsp;tidy.setCharEncoding(Configuration.UTF8);&nbsp;// 文件编码为 
                UTF8<BR>
                &nbsp;&nbsp;&nbsp;<BR>
                &nbsp;&nbsp;&nbsp;<BR>
                &nbsp;&nbsp;&nbsp;FileInputStream src = new FileInputStream( tmpNewFile 
                );&nbsp;// <BR>
                &nbsp;&nbsp;&nbsp;doc = tidy.parseDOM( src ,null );&nbsp;// 通过 <B 
style="COLOR: black; BACKGROUND-COLOR: #ffff66">JTidy</B> 将 HTML 
                网页解析为<BR>
                &nbsp;&nbsp;&nbsp;src.close();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// W3C 的 Document 
                对象<BR>
                &nbsp;&nbsp;&nbsp;tmpNewFile.delete();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 删除临时文件<BR>
                &nbsp;&nbsp;&nbsp;<BR>
                &nbsp;&nbsp;&nbsp;NodeList list = 
                doc.getChildNodes();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 页面中 DOCTYPE 中可能问题<BR>
                &nbsp;&nbsp;&nbsp;for(int i=0; 
                i&lt;list.getLength(); i++)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 删除 DOCTYPE 元素<BR>
                &nbsp;&nbsp;&nbsp;{<BR>
                &nbsp;&nbsp;&nbsp;&nbsp;Node node = 
                list.item(i);<BR>
                &nbsp;&nbsp;&nbsp;&nbsp;if( node.getNodeType() == Node.DOCUMENT_TYPE_NODE)&nbsp;// 
                查找类型定义节点<BR>
                &nbsp;&nbsp;&nbsp;&nbsp;{<BR>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;node.getParentNode().removeChild( node );<BR>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( 
                log.isLoggable( Level.INFO)){<BR>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info("已经将文档定义节点删除！" 
                );<BR>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
                &nbsp;&nbsp;&nbsp;&nbsp;}<BR>
                &nbsp;&nbsp;&nbsp;}<BR>
                &nbsp;&nbsp;&nbsp;<BR>
                &nbsp;&nbsp;&nbsp;list = 
                doc.getElementsByTagName("script");&nbsp;&nbsp;&nbsp;&nbsp;// 脚本中的注释有时有问题<BR>
                &nbsp;&nbsp;&nbsp;for(int i=0; 
                i&lt;list.getLength(); i++){&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 清理 script 元素<BR>
                &nbsp;&nbsp;&nbsp;&nbsp;Element script = 
                (Element) list.item(i);<BR>
                &nbsp;&nbsp;&nbsp;&nbsp;if( script.getFirstChild() != null){<BR>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( 
                log.isLoggable( Level.FINEST)){<BR>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.finest("删除脚本元素: " + 
                script.getFirstChild().getNodeValue());<BR>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;script.removeChild( 
                script.getFirstChild());<BR>
                &nbsp;&nbsp;&nbsp;&nbsp;}<BR>
                &nbsp;&nbsp;&nbsp;}<BR>
                &nbsp;&nbsp;&nbsp;<BR>
                &nbsp;&nbsp;&nbsp;list = 
                doc.getElementsByTagName("span");&nbsp;&nbsp;&nbsp;&nbsp;// sina 中 span 元素有时有问题<BR>
                &nbsp;&nbsp;&nbsp;for(int i=0; 
                i&lt;list.getLength(); i++){&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 清理 span 元素<BR>
                &nbsp;&nbsp;&nbsp;&nbsp;Element span = (Element) 
                list.item(i);<BR>
                &nbsp;&nbsp;&nbsp;&nbsp;span.getParentNode().removeChild( span );<BR>
                &nbsp;&nbsp;&nbsp;&nbsp;if( 
                log.isLoggable( Level.FINEST)){<BR>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.finest("删除 span 元素: " 
                );<BR>
                &nbsp;&nbsp;&nbsp;&nbsp;}<BR>
                &nbsp;&nbsp;&nbsp;&nbsp;<BR>
                &nbsp;&nbsp;&nbsp;}<BR>
                &nbsp;&nbsp;&nbsp;<BR>
                &nbsp;&nbsp;&nbsp;list = 
                doc.getElementsByTagName("sohuadcode");&nbsp;&nbsp;&nbsp;// 清除 sohuadcode 元素<BR>
                &nbsp;&nbsp;&nbsp;for(int i=0; 
                i&lt;list.getLength(); i++){<BR>
                &nbsp;&nbsp;&nbsp;&nbsp;Element sohuadcode = (Element) 
                list.item(i);<BR>
                &nbsp;&nbsp;&nbsp;&nbsp;sohuadcode.getParentNode().removeChild( sohuadcode 
                );<BR>
                &nbsp;&nbsp;&nbsp;}<BR>
                &nbsp;&nbsp;&nbsp;<BR>
                &nbsp;&nbsp;&nbsp;if( log.isLoggable( Level.INFO)){<BR>
                &nbsp;&nbsp;&nbsp;&nbsp;log.info("HTML 
                文档解析 DOM 完成.");<BR>
                &nbsp;&nbsp;&nbsp;}<BR>
                &nbsp;&nbsp;}<BR>
                &nbsp;&nbsp;catch(Exception 
                e)<BR>
                &nbsp;&nbsp;{<BR>
                &nbsp;&nbsp;&nbsp;log.severe(e.getMessage());<BR>
                &nbsp;&nbsp;&nbsp;e.printStackTrace();<BR>
                &nbsp;&nbsp;}finally<BR>
                &nbsp;&nbsp;{<BR>
                &nbsp;&nbsp;&nbsp;<BR>
                &nbsp;&nbsp;}<BR>
                &nbsp;&nbsp;return 
                doc;<BR>
                &nbsp;}<BR>
                &nbsp;<BR>
                &nbsp;/**<BR>
                &nbsp; * 解析转换的样式表，保存为模板<BR>
                &nbsp; * @param 
                xsltFileName&nbsp;&nbsp;样式表文件名<BR>
                &nbsp; * @return&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;样式表模板对象<BR>
                &nbsp; */<BR>
                &nbsp;public Templates 
                setXSLT(String xsltFileName)<BR>
                &nbsp;{<BR>
                &nbsp;&nbsp;Logger log = Logger.getLogger( "setXSLT" 
                );<BR>
                &nbsp;&nbsp;File xsltFile = new File( xsltFileName );<BR>
                &nbsp;&nbsp;StreamSource xsltSource = 
                new StreamSource( xsltFile );&nbsp;&nbsp;// 使用 JAXP 标准方法建立样式表的模板对象 <BR>
                &nbsp;&nbsp;TransformerFactory tff = TransformerFactory.newInstance();&nbsp;// 
                可以重复利用这个模板<BR>
                &nbsp;&nbsp;Templates template = null;<BR>
                &nbsp;&nbsp;try {<BR>
                &nbsp;&nbsp;&nbsp;template = 
                tff.newTemplates( xsltSource );<BR>
                &nbsp;&nbsp;&nbsp;if( log.isLoggable( 
                Level.INFO)){<BR>
                &nbsp;&nbsp;&nbsp;&nbsp;log.info("样式表文件 " + xsltFileName + " 解析完成");<BR>
                &nbsp;&nbsp;&nbsp;}<BR>
                &nbsp;&nbsp;} 
                catch (TransformerConfigurationException e) {<BR>
                &nbsp;&nbsp;&nbsp;log.severe( e.getMessage() 
                );<BR>
                &nbsp;&nbsp;}<BR>
                &nbsp;&nbsp;this.template = template;<BR>
                &nbsp;&nbsp;return 
                template;<BR>
                &nbsp;}<BR>
                &nbsp;<BR>
                &nbsp;/**<BR>
                &nbsp; * 使用样式表转换文档对象，得到最终的结果<BR>
                &nbsp; * @param 
                doc&nbsp;&nbsp;&nbsp;文档对象<BR>
                &nbsp; * @param outFileName&nbsp;保存转换结果的文件名<BR>
                &nbsp; */<BR>
                &nbsp;private void 
                Transformer(Document doc , String outFileName )<BR>
                &nbsp;{<BR>
                &nbsp;&nbsp;Logger log = 
                Logger.getLogger( "Transformer" );<BR>
                &nbsp;&nbsp;try {<BR>
                &nbsp;&nbsp;&nbsp;Source source = new 
                DOMSource( doc );<BR>
                &nbsp;&nbsp;&nbsp;<BR>
                &nbsp;&nbsp;&nbsp;File outFile = new File( outFileName 
                );<BR>
                &nbsp;&nbsp;&nbsp;Result result = new StreamResult( outFile );<BR>
                &nbsp;&nbsp;&nbsp;<BR>
                &nbsp;&nbsp;&nbsp;Transformer 
                transformer = template.newTransformer();&nbsp;// 
                使用保存的样式表模板对象<BR>
                &nbsp;&nbsp;&nbsp;transformer.transform(source, result );&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 
                生成转换器，转换文档对象<BR>
                &nbsp;&nbsp;&nbsp;if( log.isLoggable( Level.INFO)){<BR>
                &nbsp;&nbsp;&nbsp;&nbsp;log.info("转换完成, 请查看 
                " + outFileName + " 文件。");<BR>
                &nbsp;&nbsp;&nbsp;}<BR>
                &nbsp;&nbsp;} catch (Exception e) 
                {<BR>
                &nbsp;&nbsp;&nbsp;log.severe( e.getMessage() );<BR>
                &nbsp;&nbsp;}&nbsp;<BR>
                &nbsp;}<BR>
                }</DIV>
              <P class=postfoot>posted on 2006-02-27 22:14 <A 
href="http://haogj.cnblogs.com/">haogj</A> 阅读(263) <A href="http://cache.baidu.com/c?word=jtidy&url=http%3A//www%2Ecnblogs%2Ecom/haogj/archive/2007/03/15/339143%2Ehtml&p=903fda15d9c545f30be2957c564d83&user=baidu#Post">评论(1)</A> &nbsp;<A 
href="http://www.cnblogs.com/haogj/admin/EditPosts.aspx?postid=339143">编辑</A>&nbsp;<A 
href="http://www.cnblogs.com/haogj/AddToFavorite.aspx?id=339143">收藏</A> <A 
href="http://www.cnblogs.com/haogj/services/trackbacks/339143.aspx">引用</A> <A 
href="javascript:d=document;t=d.selection%3F(d.selection.type!='None'?d.selection.createRange().text:''):(d.getSelection?d.getSelection():'');void(saveit=window.open('http://wz.csdn.net/storeit.aspx?t='+escape(d.title)+'&amp;u='+escape(d.location.href)+'&amp;c='+escape(t),'saveit','scrollbars=no,width=590,height=300,left=75,top=20,status=no,resizable=yes'));saveit.focus();">网摘</A> 所属分类: <A href="http://www.cnblogs.com/haogj/category/49468.html">XML</A> </P>
            </DIV>
            <IMG height=1 
src="339143.html_webview=1" width=1> <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
xmlns:dc="http://purl.org/dc/elements/1.1/"
xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
<rdf:Description
rdf:about="http://www.cnblogs.com/haogj/archive/2006/02/27/JTidy.html"
dc:identifier="http://www.cnblogs.com/haogj/archive/2006/02/27/JTidy.html"
dc:title="使用 JTidy 协助抽取网页内容 "
trackback:ping="http://www.cnblogs.com/haogj/services/trackbacks/339143.aspx" />
</rdf:RDF>
--></DIV>
        </DIV>
        <DIV id=AjaxHolder_UpdatePanel1><A name=pagedcomment></A>
          <DIV class=container>
            <DIV class=containerheader>
              <H3>View Comments</H3>
            </DIV>
            <DIV class=containercontent id=comments>
              <DIV class=post>
                <H5><A title="permalink: re: 使用 JTidy 协助抽取网页内容 " 
href="http://cache.baidu.com/haogj/archive/2007/03/15/339143.html#675604">#</A>&nbsp;<A name=675604></A>re: 
                  使用 <B style="COLOR: black; BACKGROUND-COLOR: #ffff66">JTidy</B> 协助抽取网页内容 <A 
name=Post></A>&nbsp;&nbsp;<A onclick='return SetReplyAuhor("xiaolang")' 
href="http://cache.baidu.com/haogj/archive/2007/03/15/339143.html#post">回复</A>&nbsp;&nbsp;<A title=查看该作者发表过的评论 
href="http://www.cnblogs.com/comment?author=xiaolang" target=_blank>更多评论</A> <A 
id=AjaxHolder_Comments_CommentList_ctl00_DeleteLink 
href="javascript___doPostBack('AjaxHolder$Comments$CommentList$ctl00$DeleteLink','')"></A>&nbsp;&nbsp;<A 
id=AjaxHolder_Comments_CommentList_ctl00_EditLink></A> </H5>
                指定输出文件时，怎么老报下面的异常： <BR>
                2007-3-15 11:17:15 <B 
style="COLOR: black; BACKGROUND-COLOR: #ffff66">jtidy</B>.HTMLParserByW3CDOM 
                Transformer <BR>
                严重: java.io.FileNotFoundException: file:\e:\csm\cdcatalog.xml 
                (文件名、目录名或卷标语法不正确。) <BR>
                <BR>
                <BR>
                <BR>
                e:\csm\cdcatalog.xml 
                这个文件夹是存在的，大侠，请你写个简单的使用demo，谢谢 <BR>
                <DIV class=postfoot>2007-03-15 11:24 | <A 
id=AjaxHolder_Comments_CommentList_ctl00_NameLink target=_blank>xiaolang</A> </DIV>
              </DIV>
            </DIV>
          </DIV>
          <DIV id=AjaxHolder_Comments_divRefreshComments 
style="FONT-SIZE: 12px; MARGIN-BOTTOM: 5px; MARGIN-RIGHT: 10px; TEXT-ALIGN: right"><A 
id=AjaxHolder_Comments_refreshList 
href="javascript:__doPostBack('AjaxHolder$Comments$refreshList','')">刷新评论列表</A></DIV>
          <STYLE>
td { font-size: 12px }
.commentTextBox 
{ 
    font-family : Verdana; 
    font-size: 13px;
 }
</STYLE>
          <!--Beging Temp Save-->
          <STYLE>
.userData { BEHAVIOR: url(#default#userdata) }
	</STYLE>
          <DIV class=userData id=CommentsPersistDiv></DIV>
          <!--Ene TempSave-->
          <DIV class=commentform><BR>
            <BR>
            <SPAN id=AjaxHolder_PostComment_ltSubmitMsg><FONT 
color=red></FONT></SPAN><BR>
            <A name=Feedback></A>
            <TABLE cellSpacing=1 cellPadding=1 border=0>
              <TBODY>
                <TR>
                  <TD width=75></TD>
                  <TD></TD>
                  <TD></TD>
                </TR>
                <TR>
                  <TD width=55>标题</TD>
                  <TD><INPUT class=commenttb id=AjaxHolder_PostComment_tbTitle 
style="WIDTH: 320px" value="re: 使用 JTidy 协助抽取网页内容 " 
name=AjaxHolder$PostComment$tbTitle></TD>
                  <TD>&nbsp;</TD>
                </TR>
                <TR>
                  <TD>姓名</TD>
                  <TD><INPUT class=commenttb id=AjaxHolder_PostComment_tbName style="WIDTH: 320px" 
name=AjaxHolder$PostComment$tbName></TD>
                  <TD>&nbsp;</TD>
                </TR>
                <TR>
                  <TD>主页</TD>
                  <TD><INPUT class=commenttb id=AjaxHolder_PostComment_tbUrl style="WIDTH: 320px" 
name=AjaxHolder$PostComment$tbUrl></TD>
                  <TD><FONT face=宋体></FONT></TD>
                </TR>
                <TR>
                  <TD align=left colSpan=3><TABLE class=CommentForm id=AjaxHolder_PostComment_tbCaptchaImage cellSpacing=0 
cellPadding=0 border=0>
                      <TBODY>
                        <TR>
                          <TD colSpan=3><SPAN id=AjaxHolder_PostComment_lblImage><B><FONT 
color=red></FONT></B></SPAN></TD>
                        </TR>
                        <TR>
                          <TD width=78>验证码</TD>
                          <TD><INPUT id=AjaxHolder_PostComment_CodeNumberTextBox 
name=AjaxHolder$PostComment$CodeNumberTextBox>
                            *&nbsp;&nbsp;<IMG 
src="JpegImage.aspx_cacheid=20070320010304"></TD>
                          <TD align=left></TD>
                        </TR>
                      </TBODY>
                    </TABLE></TD>
                </TR>
                <TR>
                  <TD colSpan=3>内容(提交失败后,可以通过“恢复上次提交”恢复刚刚提交的内容) &nbsp;<BR>
                    <TEXTAREA class=commentTextBox id=AjaxHolder_PostComment_tbComment onkeydown="ctlent(event,'AjaxHolder_PostComment_tbComment')" style="WIDTH: 480px; HEIGHT: 220px" name=AjaxHolder$PostComment$tbComment rows=10 cols=50></TEXTAREA></TD>
                </TR>
                <TR>
                  <TD colSpan=3><SPAN id=AjaxHolder_PostComment_Message><FONT 
color=red></FONT></SPAN></TD>
                <TR>
                  <TD colSpan=3><INPUT id=AjaxHolder_PostComment_chkRemember tabIndex=-1 
type=checkbox CHECKED name=AjaxHolder$PostComment$chkRemember>
                    <LABEL 
for=AjaxHolder_PostComment_chkRemember>Remember Me?</LABEL></TD>
                </TR>
                <TR>
                  <TD height=23><INPUT id=AjaxHolder_PostComment_btnSubmit onclick="TempSave('AjaxHolder_PostComment_tbComment');WebForm_DoPostBackWithOptions(new WebForm_PostBackOptions(&quot;AjaxHolder$PostComment$btnSubmit&quot;, &quot;&quot;, true, &quot;&quot;, &quot;&quot;, false, false))" type=submit value=提交 name=AjaxHolder$PostComment$btnSubmit></TD>
                  <TD colSpan=2 height=23>&nbsp; <A id=AjaxHolder_PostComment_lnkLogin 
href="http://www.cnblogs.com/login.aspx?ReturnURL=http://www.cnblogs.com/haogj/archive/2007/03/15/339143.html&amp;SourceURL=/haogj/archive/2007/03/15/339143.html">登录</A>&nbsp;&nbsp;<A 
id=AjaxHolder_PostComment_linkLoginComment 
onclick="if(document.getElementById('AjaxHolder_PostComment_tbComment').value != '') return confirm('未提交的评论内容将会丢失, 你真的要进入高级评论吗?');" 
href="http://www.cnblogs.com/haogj/archive/2007/03/15/339143.html?login=1#Post">使用高级评论</A>&nbsp;&nbsp;<A 
href="http://www.cnblogs.com/RequireRegister.aspx">新用户注册</A>&nbsp;&nbsp;<A 
href="http://cache.baidu.com/c?word=jtidy&url=http%3A//www%2Ecnblogs%2Ecom/haogj/archive/2007/03/15/339143%2Ehtml&p=903fda15d9c545f30be2957c564d83&user=baidu#Top">返回页首</A>&nbsp;&nbsp;<A id=AjaxHolder_PostComment_lbRestore 
onclick="Restore('AjaxHolder_PostComment_tbComment'); return false;" 
href="http://cache.baidu.com/haogj/archive/2007/03/15/339143.html#Post">恢复上次提交</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </TD>
                </TR>
                <TR>
                  <TD colSpan=3>[使用Ctrl+Enter键可以直接提交]</TD>
                </TR>
                <TR>
                  <TD colSpan=3 height=5><DIV id=divRelativePosts>相关文章:
                      <UL style="MARGIN-TOP: 0px">
                        <LI style="LIST-STYLE-TYPE: none"><A 
id=AjaxHolder_PostComment_ctl06_RelativePostsList_ctl01_Hyperlink1 
href="http://www.cnblogs.com/haogj/archive/2006/02/27/339145.html">用于解析 sina 
                          新闻页面的 XSLT 文件</A>
                        <LI style="DISPLAY: none; LIST-STYLE-TYPE: none"><A 
id=AjaxHolder_PostComment_ctl06_RelativePostsList_ctl02_Hyperlink1 
href="http://www.cnblogs.com/haogj/archive/2006/02/27/JTidy.html">使用 <B 
style="COLOR: black; BACKGROUND-COLOR: #ffff66">JTidy</B> 协助抽取网页内容 </A></LI>
                      </UL>
                    </DIV></TD>
                </TR>
                <TR>
                  <TD colSpan=3></TD>
                </TR>
                <TR>
                  <TD colSpan=3><DIV id=RecommendedProducts>推荐商品<BR>
                      <A 
href="http://www.pianyiba.com/product/600651/">绝句作法类举</A><BR>
                      <A 
href="http://www.pianyiba.com/product/600652/">传统人生哲学智慧散论</A><BR>
                      <A 
href="http://www.pianyiba.com/product/600653/">中国制度变迁的案例研究（浙江卷）（第五集）</A><BR>
                      <A 
href="http://www.pianyiba.com/product/600654/">高级中学综合实践活动研究性学习教程</A><BR>
                      <A 
href="http://www.pianyiba.com/product/600655/">自然瑰宝神奇的珍珠</A></DIV></TD>
                </TR>
                <TR>
                  <TD colSpan=3><BR>
                    <BR>
                    <IFRAME 
style="BORDER-RIGHT: #666 0px solid; BORDER-TOP: #666 0px solid; BORDER-LEFT: #666 0px solid; BORDER-BOTTOM: #666 0px solid" 
marginWidth=0 marginHeight=0 src="ad.htm" frameBorder=0 
width=468 scrolling=no height=80 
allowTransparency></IFRAME>
                    <BR></TD>
                </TR>
              </TBODY>
            </TABLE>
          </DIV>
        </DIV>
      </DIV>
    </DIV>
    <DIV class=clearing>&nbsp;</DIV>
  </DIV>
  <DIV id=footer>Powered by:<BR>
    <A id=Footer1_Hyperlink3 
href="http://www.cnblogs.com/" name=Hyperlink1><FONT 
face=Verdana>博客园</FONT></A><BR>
    Copyright ? haogj </DIV>
</FORM>
<!--EndFragment-->
</BODY>
</HTML>