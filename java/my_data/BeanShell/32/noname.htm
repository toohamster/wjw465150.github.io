<!-- saved from url=http://www-128.ibm.com/developerworks/cn/java/l-beanshell/index.html -->
<script>
window.onerror = new Function("return(false);")
</script><!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3c.org/TR/1999/REC-html401-19991224/loose.dtd">

<HTML lang=zh-CN xml:lang="zh-CN" 
xmlns="http://www.w3.org/1999/xhtml"><HEAD><TITLE>BeanShell为Java应用程序加入脚本引擎</TITLE><LINK 
href="" rel=schema.DC><LINK 
href="favicon.ico" rel="SHORTCUT ICON"><LINK 
media=screen,print href="table.css" type=text/css 
rel=stylesheet>
<SCRIPT language=JavaScript src="dwcss14.js" 
type=text/javascript></SCRIPT>
<LINK href="/developerworks/css/ie6v14.css" type=text/css 
rel=stylesheet><NOSCRIPT><link rel="stylesheet" href="r1ss.css" type="text/css"/></NOSCRIPT><LINK 
href="main.css" type=text/css rel=stylesheet><LINK 
media=all href="screen.css" type=text/css 
rel=stylesheet><LINK media=print href="print.css" 
type=text/css rel=stylesheet>
<SCRIPT language=JavaScript src="detection.js" 
type=text/javascript></SCRIPT>
<LINK media=screen href="ie2_screen.css" 
type=text/css rel=stylesheet>
<SCRIPT language=JavaScript src="dropdown.js" 
type=text/javascript></SCRIPT>

<SCRIPT language=JavaScript src="grabtitle.js" 
type=text/javascript></SCRIPT>

<SCRIPT language=JavaScript src="emailfriend2.js" 
type=text/javascript></SCRIPT>
<!--START RESERVED FOR FUTURE USE INCLUDE FILES-->
<SCRIPT language=javascript src="ajax1.js" 
type=text/javascript></SCRIPT>

<SCRIPT language=javascript src="searchcount.js" 
type=text/javascript></SCRIPT>
<!--END RESERVED FOR FUTURE USE INCLUDE FILES-->
<SCRIPT language=JavaScript 
type=text/javascript>var emailAbstract = ""; </SCRIPT>
</HEAD>

<BODY><!--StartFragment--><!--MASTHEAD_BEGIN-->
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR vAlign=top>
<TD class=bbg width=110><A href="http://www.ibm.com/cn/"><IMG height=52 alt=IBM? 
src="ibm-logo.gif" width=110 border=0></A></TD>
<TD class=bbg><IMG height=1 alt="" src="c.gif" width=1 
border=0></TD>
<TD class=mbbg align=right width=650>
<TABLE cellSpacing=0 cellPadding=0 align=right border=0>
<TBODY>
<TR class=cty-tou>
<TD class=upper-masthead-corner width=17 rowSpan=2><A href="http://www-128.ibm.com/developerworks/cn/java/l-beanshell/index.html#main"><IMG height=1 
alt=跳转到主要内容 src="c.gif" width=1 border=0></A></TD>
<TD align=left>
<TABLE cellSpacing=0 cellPadding=0 align=left border=0>
<TBODY>
<TR>
<TD><SPAN class=spacer>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><B class=country>中国</B><SPAN 
class=spacer>&nbsp;[</SPAN><A class=ur-link 
href="">选择</A><SPAN 
class=spacer>]</SPAN></TD>
<TD class=upper-masthead-divider width=29>&nbsp;&nbsp;&nbsp;&nbsp;</TD>
<TD align=left><A class=ur-link 
href="">使用条款</A></TD></TR></TBODY></TABLE></TD>
<TD width=40>&nbsp;</TD></TR>
<TR>
<TD class=cty-tou-border colSpan=2 height=1><IMG height=1 alt="" 
src="c.gif" width=1></TD></TR>
<TR>
<TD colSpan=3><IMG height=8 alt="" src="c.gif" 
width=1></TD></TR>
<TR>
<TD>&nbsp;</TD>
<TD align=middle colSpan=2>
<FORM id=form1 name=form1 
action=http://www-128.ibm.com/developerworks/search/searchResults.jsp 
method=get><INPUT type=hidden value=1 name=searchType><INPUT type=hidden 
value=dWChina name=searchSite><INPUT type=hidden value=zh name=pageLang><INPUT 
type=hidden value=UTF8 name=langEncoding>
<TABLE cellSpacing=0 cellPadding=0 border=0>
<TBODY>
<TR>
<TD width=1><IMG height=1 alt="Select a scope:" src="c.gif" 
width=1></TD>
<TD align=right><LABEL for=sq><SELECT class=input-scope id=sq 
name=searchScope><OPTION value=dW selected>dW 全部内容</OPTION><OPTION 
value=dW>-----------------</OPTION><OPTION value=aixunix>&nbsp;&nbsp;AIX and 
UNIX</OPTION><OPTION value=dmdd>&nbsp;&nbsp;Information management</OPTION><OPTION 
value=lotusdd>&nbsp;&nbsp;Lotus</OPTION><OPTION value=rdd>&nbsp;&nbsp;Rational</OPTION><OPTION 
value=tivolidd>&nbsp;&nbsp;Tivoli</OPTION><OPTION value=wsdd>&nbsp;&nbsp;WebSphere</OPTION><OPTION 
value=workplace>&nbsp;&nbsp;Workplace</OPTION><OPTION 
value=dW>-----------------</OPTION><OPTION value=gridZ>&nbsp;&nbsp;Grid 
computing</OPTION><OPTION value=javaZ>&nbsp;&nbsp;Java 技术</OPTION><OPTION 
value=linuxZ>&nbsp;&nbsp;Linux</OPTION><OPTION value=opensrcZ>&nbsp;&nbsp;Open 
source</OPTION><OPTION value=securityZ>&nbsp;&nbsp;Security</OPTION><OPTION 
value=webservZ>&nbsp;&nbsp;SOA &amp; Web services</OPTION><OPTION value=webarchZ>&nbsp;&nbsp;Web 
development</OPTION><OPTION value=xmlZ>&nbsp;&nbsp;XML</OPTION><OPTION 
value=dW>-----------------</OPTION><OPTION value=all>IBM 
全部内容</OPTION></SELECT></LABEL></TD>
<TD align=right width=1><IMG height=1 alt="Search for:" 
src="c.gif" width=1>&nbsp;&nbsp;</TD>
<TD align=right><INPUT class=input id=q maxLength=100 size=15 name=query></TD>
<TD width=7>&nbsp;</TD>
<TD><LABEL for=q><INPUT type=image alt=搜索 
src="search.gif" value=搜索 name=Search></LABEL></TD>
<TD 
width=20>&nbsp;</TD></TR></TBODY></TABLE></FORM></TD></TR></TBODY></TABLE></TD></TR>
<TR>
<TD class=blbg colSpan=3>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR>
<TD>
<TABLE cellSpacing=0 cellPadding=0 border=0>
<TBODY>
<TR>
<TD><SPAN class=spacer>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN></TD>
<TD><A class=masthead-mainlink href="http://www.ibm.com/cn/">首页</A></TD>
<TD class=masthead-divider width=27>&nbsp;&nbsp;&nbsp;&nbsp;</TD>
<TD><A class=masthead-mainlink 
href="">产品</A></TD>
<TD class=masthead-divider width=27>&nbsp;&nbsp;&nbsp;&nbsp;</TD>
<TD><A class=masthead-mainlink 
href="">服务与解决方案</A></TD>
<TD class=masthead-divider width=27>&nbsp;&nbsp;&nbsp;&nbsp;</TD>
<TD><A class=masthead-mainlink 
href="">支持与下载</A></TD>
<TD class=masthead-divider width=27>&nbsp;&nbsp;&nbsp;&nbsp;</TD>
<TD><A class=masthead-mainlink 
href="">个性化服务</A></TD>
<TD><SPAN 
class=spacer>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE><!--
<script src="pmh.js" language="JavaScript" type="text/javascript"></script>
--><!-- end masthead dw liquid --><!--MASTHEAD_END--><!-- CMA ID for this content is: 163092 -->
<TABLE id=v14-body-table cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR vAlign=top><!--LEFTNAV_BEGIN-->
<TD id=navigation width=150>
<TABLE cellSpacing=0 cellPadding=0 width=150 border=0>
<TBODY>
<TR>
<TD class=left-nav-spacer><A class=left-nav-overview 
href="http://www.ibm.com/developerworks/cn/">&nbsp;</A></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width=150 border=0>
<TBODY>
<TR>
<TD class=left-nav-overview colSpan=2><A class=left-nav-overview 
href="http://www.ibm.com/developerworks/cn/">developerWorks<BR>中国</A></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width=150 border=0>
<TBODY>
<TR>
<TD class=left-nav-highlight colSpan=2><A class=left-nav 
href="http://www-128.ibm.com/developerworks/cn/java/l-beanshell/index.html#">本文内容包括:</A></TD></TR>
<TR class=left-nav-child-highlight>
<TD><IMG height=8 alt="" src="cl-bullet.gif" width=2></TD>
<TD><A class=left-nav-child href="http://www-128.ibm.com/developerworks/cn/java/l-beanshell/index.html#1">前言</A></TD></TR>
<TR class=left-nav-child-highlight>
<TD><IMG height=8 alt="" src="cl-bullet.gif" width=2></TD>
<TD><A class=left-nav-child href="http://www-128.ibm.com/developerworks/cn/java/l-beanshell/index.html#2">常见的脚本引擎</A></TD></TR>
<TR class=left-nav-child-highlight>
<TD><IMG height=8 alt="" src="cl-bullet.gif" width=2></TD>
<TD><A class=left-nav-child href="http://www-128.ibm.com/developerworks/cn/java/l-beanshell/index.html#3">什么是BeanShell?</A></TD></TR>
<TR class=left-nav-child-highlight>
<TD><IMG height=8 alt="" src="cl-bullet.gif" width=2></TD>
<TD><A class=left-nav-child href="http://www-128.ibm.com/developerworks/cn/java/l-beanshell/index.html#4">BeanShell脚本语言简介</A></TD></TR>
<TR class=left-nav-child-highlight>
<TD><IMG height=8 alt="" src="cl-bullet.gif" width=2></TD>
<TD><A class=left-nav-child href="http://www-128.ibm.com/developerworks/cn/java/l-beanshell/index.html#5">在应用程序中嵌入脚本引擎</A></TD></TR>
<TR class=left-nav-child-highlight>
<TD><IMG height=8 alt="" src="cl-bullet.gif" width=2></TD>
<TD><A class=left-nav-child href="http://www-128.ibm.com/developerworks/cn/java/l-beanshell/index.html#6">示例程序</A></TD></TR>
<TR class=left-nav-child-highlight>
<TD><IMG height=8 alt="" src="cl-bullet.gif" width=2></TD>
<TD><A class=left-nav-child href="http://www-128.ibm.com/developerworks/cn/java/l-beanshell/index.html#7">写一个简单的脚本</A></TD></TR>
<TR class=left-nav-child-highlight>
<TD><IMG height=8 alt="" src="cl-bullet.gif" width=2></TD>
<TD><A class=left-nav-child href="http://www-128.ibm.com/developerworks/cn/java/l-beanshell/index.html#8">总结</A></TD></TR>
<TR class=left-nav-child-highlight>
<TD><IMG height=8 alt="" src="cl-bullet.gif" width=2></TD>
<TD><A class=left-nav-child href="http://www-128.ibm.com/developerworks/cn/java/l-beanshell/index.html#9">例程下载</A></TD></TR>
<TR class=left-nav-child-highlight>
<TD><IMG height=8 alt="" src="cl-bullet.gif" width=2></TD>
<TD><A class=left-nav-child href="http://www-128.ibm.com/developerworks/cn/java/l-beanshell/index.html#resources">参考资料 </A></TD></TR>
<TR class=left-nav-child-highlight>
<TD><IMG height=8 alt="" src="cl-bullet.gif" width=2></TD>
<TD><A class=left-nav-child href="http://www-128.ibm.com/developerworks/cn/java/l-beanshell/index.html#author">关于作者</A></TD></TR>
<TR class=left-nav-child-highlight>
<TD><IMG height=8 alt="" src="cl-bullet.gif" width=2></TD>
<TD><A class=left-nav-child href="http://www-128.ibm.com/developerworks/cn/java/l-beanshell/index.html#rate">对本文的评价</A></TD></TR>
<TR class=left-nav-last>
<TD width=14><IMG class=display-img height=1 alt="" 
src="c.gif" width=14></TD>
<TD width=136><IMG class=display-img height=19 alt="" 
src="left-nav-corner.gif" 
width=136></TD></TR></TBODY></TABLE><BR>
<TABLE cellSpacing=0 cellPadding=0 width=150 border=0>
<TBODY>
<TR>
<TD class=related colSpan=2><B class=related>相关链接:</B></TD></TR>
<TR class=rlinks>
<TD><IMG height=8 alt="" src="rl-bullet.gif" width=2></TD>
<TD><A class=rlinks 
href="http://www.ibm.com/developerworks/cn/views/java/articles.jsp">Java 
technology 技术文档库</A></TD></TR><!--START RESERVED FOR FUTURE USE INCLUDE FILES--><!-- No content currently --><!--END RESERVED FOR FUTURE USE INCLUDE FILES-->
<TR>
<TD width=14><IMG class=display-img height=1 alt="" 
src="c.gif" width=14></TD>
<TD width=136><IMG class=display-img height=19 alt="" 
src="c.gif" width=136></TD></TR></TBODY></TABLE><!--START RESERVED FOR FUTURE USE INCLUDE FILES--><!-- No content currently --><!--END RESERVED FOR FUTURE USE INCLUDE FILES--></TD><!--LEFTNAV_END-->
<TD width="100%">
<TABLE id=content-table cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR vAlign=top>
<TD width="100%">
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR>
<TD><A name=main><IMG height=1 alt="skip to main content" 
src="c.gif" width=592 
border=0></A></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR vAlign=top>
<TD width=10 height=18><IMG height=18 alt="" src="c.gif" 
width=10></TD>
<TD width="100%"><IMG height=6 alt="" src="c.gif" 
width=1><BR><A class=bctl 
href="http://www.ibm.com/developerworks/cn/">developerWorks 中国</A><SPAN 
class=bct>&nbsp;&nbsp;&gt;&nbsp;&nbsp;</SPAN><A class=bctl 
href="http://www.ibm.com/developerworks/cn/java/">Java technology</A><SPAN 
class=bct>&nbsp;&nbsp;&gt;</SPAN><IMG height=1 alt="" src="c.gif" 
width=1><BR>
<H1>为Java应用程序加入脚本引擎</H1><IMG class=display-img height=6 alt="" 
src="c.gif" width=1></TD>
<TD class=no-print width=192><IMG height=18 alt=developerWorks 
src="dw.gif" 
width=192></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR vAlign=top>
<TD width=10><IMG height=1 alt="" src="c.gif" 
width=10></TD>
<TD width="100%">
<TABLE class=no-print cellSpacing=0 cellPadding=0 width=160 align=right 
border=0>
<TBODY>
<TR>
<TD width=10><IMG height=1 alt="" src="c.gif" 
width=10></TD>
<TD>
<TABLE cellSpacing=0 cellPadding=0 width=150 border=0>
<TBODY>
<TR>
<TD class=v14-header-1-small>文档选项</TD></TR></TBODY></TABLE>
<TABLE class=v14-gray-table-border cellSpacing=0 cellPadding=0 border=0>
<TBODY>
<TR>
<TD class=no-padding width=150>
<TABLE cellSpacing=0 cellPadding=0 width=143 border=0><IMG height=1 alt="" 
src="c.gif" width=8>
<FORM name=email 
action=https://www.ibm.com/developerworks/secure/email-it.jsp><INPUT type=hidden 
name=body><INPUT type=hidden value=为Java应用程序加入脚本引擎 name=subject><INPUT 
type=hidden value=cn name=lang>
<SCRIPT language=JavaScript type=text/javascript>
<!--
document.write('<tr valign="top"><td width="8"><img src="c.gif" width="8" height="1" alt=""/></td><td width="16"><img src="em.gif" height="16" width="16" vspace="3" alt="将此页作为电子邮件发送" /></td><td width="122"><p><a class="smallplainlink" href="javascript:document.email.submit();"><b>将此页作为电子邮件发送</b></a></p></td></tr>');
//-->
</SCRIPT>

<TBODY>
<TR vAlign=top>
<TD width=8><IMG height=1 alt="" src="c.gif" width=8></TD>
<TD width=16><IMG height=16 alt=将此页作为电子邮件发送 
src="em.gif" width=16 vspace=3></TD>
<TD width=122>
<P><A class=smallplainlink 
href="javascript_document.email.submit();"><B>将此页作为电子邮件发送</B></A></P></TD></TR><NOSCRIPT><tr valign="top"><td width="8"><img alt="" height="1" width="8" src="c.gif"/></td><td width="16"><img alt="" width="16" height="16" src="c.gif"/></td><td class="small" width="122"><p><span class="ast">未显示需要 JavaScript 的文档选项</span></p></td></tr></NOSCRIPT></FORM></TBODY></TABLE></TD></TR></TBODY></TABLE><!--START RESERVED FOR FUTURE USE INCLUDE FILES--><!-- this content will be automatically generated across all content areas --><BR><!--END RESERVED FOR FUTURE USE INCLUDE FILES--><BR></TD></TR></TBODY></TABLE>
<P>级别: 初级</P>
<P><A href="http://www-128.ibm.com/developerworks/cn/java/l-beanshell/index.html#author">陈先波</A> (<A 
href="mailto:turbochen@163.com%3Fsubject=为Java应用程序加入脚本引擎%26amp;cc=turbochen@163.com">turbochen@163.com</A>)赛微科技<BR></P>
<P>2002 年 11 月 12 日<BR>2002 年 11 月 12 日 更新 </P>
<BLOCKQUOTE></BLOCKQUOTE><!--START RESERVED FOR FUTURE USE INCLUDE FILES--><!-- include java script once we verify teams wants to use this and it will work on dbcs and cyrillic characters --><!--END RESERVED FOR FUTURE USE INCLUDE FILES-->
<P><A name=1><SPAN class=atitle>前言</SPAN></A></P>
<P>现代许多流行的应用程序，越来越多的使用了脚本引擎，最典型的有Microsoft 
Office中的VBA等。脚本引擎能提供应用程序极大的可扩展性，也是被许多热忠于二次开发的使用者所乐意看到的。本文主要讲解BeanShell----这样一个Java应用程序脚本引擎，你会了解它的基本特性，及如何将它嵌入到你的应用程序中。你将看到，为自己的应用程序加上脚本引擎是多么容易的一件事情。</P><BR>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR>
<TD><IMG height=1 alt="" src="blue_rule.gif" 
width="100%"><BR><IMG height=6 alt="" src="c.gif" width=8 
border=0></TD></TR></TBODY></TABLE>
<TABLE class=no-print cellSpacing=0 cellPadding=0 align=right>
<TBODY>
<TR align=right>
<TD><IMG height=4 alt="" src="c.gif" width="100%"><BR>
<TABLE cellSpacing=0 cellPadding=0 border=0>
<TBODY>
<TR>
<TD vAlign=center><IMG height=16 alt="" 
src="u_bold.gif" width=16 border=0><BR></TD>
<TD vAlign=top align=right><A class=fbox 
href="http://www-128.ibm.com/developerworks/cn/java/l-beanshell/index.html#main"><B>回页首</B></A></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE><BR><BR>
<P><A name=2><SPAN class=atitle>常见的脚本引擎</SPAN></A></P>
<P>现在网络上流行着许多种脚本语言，如TCL，Perl, 
JavaScript，Python等，并且有许多脚本语言都有基于Java的解释器，就笔者所知道的有如下几种：</P>
<TABLE width="60%" border=1>
<TBODY>
<TR>
<TD>Language</TD>
<TD>Java Implementation</TD></TR>
<TR>
<TD>JavaScript</TD>
<TD>Rhino</TD></TR>
<TR>
<TD>Python</TD>
<TD>Jython (formerly JPython)</TD></TR>
<TR>
<TD>Tcl/Tk</TD>
<TD>Jacl</TD></TR>
<TR>
<TD>Perl</TD>
<TD>None</TD></TR>
<TR>
<TD>Java itself</TD>
<TD>BeanShell</TD></TR></TBODY></TABLE>
<P>以上几种脚本都有各自的语法，而其中JavaScript和BeanShell的语法，对于使用者来说更具有亲切感。本文主要讲解BeanShell的的特性及其如何集成到Java应用程序中。</P><BR>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR>
<TD><IMG height=1 alt="" src="blue_rule.gif" 
width="100%"><BR><IMG height=6 alt="" src="c.gif" width=8 
border=0></TD></TR></TBODY></TABLE>
<TABLE class=no-print cellSpacing=0 cellPadding=0 align=right>
<TBODY>
<TR align=right>
<TD><IMG height=4 alt="" src="c.gif" width="100%"><BR>
<TABLE cellSpacing=0 cellPadding=0 border=0>
<TBODY>
<TR>
<TD vAlign=center><IMG height=16 alt="" 
src="u_bold.gif" width=16 border=0><BR></TD>
<TD vAlign=top align=right><A class=fbox 
href="http://www-128.ibm.com/developerworks/cn/java/l-beanshell/index.html#main"><B>回页首</B></A></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE><BR><BR>
<P><A name=3><SPAN class=atitle>什么是BeanShell?</SPAN></A></P>
<P>BeanShell是一个小型的，免费的，可嵌入式的，具有面向对象脚本语言特性的Java代码解释器。它是用Java语言写的。它能执行标准的Java语句和表达式，还自带简单的脚本命令和语法。它把编程对象当成一个简单的方法，这很像Perl和JavaScript.</P>
<P>你可以在写Java测试或调试时使用BeanShell，也可以用它作为你的应用程序的脚本引挚。简而言之，BeanShell可以动态的解释JAVA语言。也就是说BeanShell在许多方面对于Java的用处就像Tcl/Tk对于C的用处一样：BeanShell是可嵌入式的---你可以在运行时从你的应用程序调用BeanShell去动态的执行Java代码或是为你的应用程序提供脚本扩展。相反，你也可以从BeanShell调用你的应用程序及其对象，它可以让JAVA对象和API动态运行。正因为BeanShell是用JAVA写的，所以它可以和你的应用程序运行在同一个JVM空间内，你也可以自由的传递实时对象的引用(References)到脚本代码中并且作为结果返回。</P><BR>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR>
<TD><IMG height=1 alt="" src="blue_rule.gif" 
width="100%"><BR><IMG height=6 alt="" src="c.gif" width=8 
border=0></TD></TR></TBODY></TABLE>
<TABLE class=no-print cellSpacing=0 cellPadding=0 align=right>
<TBODY>
<TR align=right>
<TD><IMG height=4 alt="" src="c.gif" width="100%"><BR>
<TABLE cellSpacing=0 cellPadding=0 border=0>
<TBODY>
<TR>
<TD vAlign=center><IMG height=16 alt="" 
src="u_bold.gif" width=16 border=0><BR></TD>
<TD vAlign=top align=right><A class=fbox 
href="http://www-128.ibm.com/developerworks/cn/java/l-beanshell/index.html#main"><B>回页首</B></A></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE><BR><BR>
<P><A name=4><SPAN class=atitle>BeanShell脚本语言简介</SPAN></A></P>
<P>BeanShell能理解标准的JAVA语句，表达式，和方法宣告。语句和表达式的内容可以是：变量，宣告，赋值，方法调用，循环，条件等。</P>
<P>在Java程序中你必须严格的使用它们，但在BeanShell中，你可以用"宽松类型"(loosely 
typed)的方式来使用它们。也就是说，你可以在写脚本时偷懒，不进行变量类型的宣告(在原始数据类型和对象都可以)。如果你试着用错变量类型，BeanShell将会给出一个错误。总之BeanShell的脚本是很容易上手的。</P>
<P>这里有一个简单的例子：</P>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR>
<TD class=code-outline><PRE class=displaycode>foo = "Foo";    
four = (2 + 2)*2/2;
print( foo + " = " + four );  // print() 是BeanShell的一个脚本命令。
// 循环
for (i=0; i&lt;5; i++)
    print(i);   
//显示一个有包含一个按钮的窗口
button = new JButton( "My Button" );
frame = new JFrame( "My Frame" );
frame.getContentPane().add( button, "Center" );
frame.pack();
frame.setVisible(true);
</PRE></TD></TR></TBODY></TABLE><BR>
<P>你也可以在Beanshell脚本中宣告和定义自己的方法：</P>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR>
<TD class=code-outline><PRE class=displaycode>int multiply(int a, int b)
{
    return a*b;
}
print(multiply(12,14));//打印出168
</PRE></TD></TR></TBODY></TABLE><BR>
<P>BeanShell的变量或参数的类型可以不用显示的指定，如下：</P>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR>
<TD class=code-outline><PRE class=displaycode>int multiply(a, b)
{
    return a*b;
}
result = multiply(12,14);
print(result);//打印出168
</PRE></TD></TR></TBODY></TABLE><BR>
<P>在BeanShell中也可以写对象。它与JavaScript很相似，它用一个方法，再内嵌一些内部方法，并且在未尾返回一个this来实现对象的编程：</P>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR>
<TD class=code-outline><PRE class=displaycode>Employee()
{
	age = 26;
	sex = "M";
	name = "Turbo";
	int getAge()
	{
		return age; 
}
String getSex()
{
	return sex;
}
String getName()
{
	return name;
}
return this;
}
turbo = Employee(); // 构造一个Employee对象。
print("Name:"+turbo.getName); //打印出employee的名字。
</PRE></TD></TR></TBODY></TABLE><BR>
<P>上面的程序片断，相信大家已经对BeanShell的语法有了一个印象，你可以通过参考资料中的链接，找到更详细的BeanShell的脚本语法教程。</P><BR>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR>
<TD><IMG height=1 alt="" src="blue_rule.gif" 
width="100%"><BR><IMG height=6 alt="" src="c.gif" width=8 
border=0></TD></TR></TBODY></TABLE>
<TABLE class=no-print cellSpacing=0 cellPadding=0 align=right>
<TBODY>
<TR align=right>
<TD><IMG height=4 alt="" src="c.gif" width="100%"><BR>
<TABLE cellSpacing=0 cellPadding=0 border=0>
<TBODY>
<TR>
<TD vAlign=center><IMG height=16 alt="" 
src="u_bold.gif" width=16 border=0><BR></TD>
<TD vAlign=top align=right><A class=fbox 
href="http://www-128.ibm.com/developerworks/cn/java/l-beanshell/index.html#main"><B>回页首</B></A></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE><BR><BR>
<P><A name=5><SPAN class=atitle>在应用程序中嵌入脚本引擎</SPAN></A></P>
<P>其实在Java中调用bsh的脚本非常简单，你需要先创建一个Interpreter类的实例.然后就可以用它运行你的脚本代码或者脚本文件。请看下面的一个例子，这个例子来自于BeanShell的文档：</P>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR>
<TD class=code-outline><PRE class=displaycode>Import bsh.*;
//创建一个bsh解释器实例
Interpeter bsh = new Interpreter();
 
 // 表达式求值
 bsh.eval("foo=Math.sin(0.5)");
 bsh.eval("bar=foo*5; bar=Math.cos(bar);");
 bsh.eval("for(i=0; i&lt;10; i) { print(\"hello\"); }");
 // 运行语句。
 bsh.eval("for(int i=0; i&lt;10; i) { System.out.println(\"hello\"); }");
 // 载入脚本文件
 bsh.source("myscript.bsh");  // or bsh.eval("source(\"myscript.bsh\")");
 // 使用set()和get()方法存取变量值。
 bsh.set( "date", new Date() );
 Date date = (Date)bsh.get( "date" );
 // This would also work:
 Date date = (Date)bsh.eval( "date" );
 bsh.eval("year = date.getYear()");
 Integer year = (Integer)bsh.get("year");  // primitives use wrappers
 // 也可以实现任意的Java Interface..
 // 或处理AWT事件。
 bsh.eval( "actionPerformed( e ) { print( e ); }");
 ActionListener scriptedHandler = 
         (ActionListener)bsh.eval("return (ActionListener)this");
 Use the scripted event handler normally...
 new JButton.addActionListener( script );
</PRE></TD></TR></TBODY></TABLE><BR><BR>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR>
<TD><IMG height=1 alt="" src="blue_rule.gif" 
width="100%"><BR><IMG height=6 alt="" src="c.gif" width=8 
border=0></TD></TR></TBODY></TABLE>
<TABLE class=no-print cellSpacing=0 cellPadding=0 align=right>
<TBODY>
<TR align=right>
<TD><IMG height=4 alt="" src="c.gif" width="100%"><BR>
<TABLE cellSpacing=0 cellPadding=0 border=0>
<TBODY>
<TR>
<TD vAlign=center><IMG height=16 alt="" 
src="u_bold.gif" width=16 border=0><BR></TD>
<TD vAlign=top align=right><A class=fbox 
href="http://www-128.ibm.com/developerworks/cn/java/l-beanshell/index.html#main"><B>回页首</B></A></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE><BR><BR>
<P><A name=6><SPAN class=atitle>示例程序</SPAN></A></P>
<P>为了让读者更好的理解，我们在这里以jdk1.4中的一个演示程序，Notepad程序作为基础，向读者讲解BeanShell是如何嵌入到Notepad程序中的。如果你安装了JDK1.4的话，Notepad源程序可以在&lt;JAVA_HOME&gt;\demo\jfc\Notepad目录中找到.</P>
<P>笔者写的一个BeanShell类，用来运行用户的脚本，下面的该程序的完整清单：</P>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR>
<TD class=code-outline><PRE class=displaycode>import javax.swing.text.*;
import javax.swing.*;
import java.io.*;
import bsh.*;
public class BeanShell
{
	private static NameSpace namespace;
	private static boolean running;
	private static Notepad notepad;
	//初始化引擎
	public static void initBeanShell(Notepad pad)
	{
		notepad = pad;
		namespace = new NameSpace("Notepad embedded scripting engine.");
	}
	//运行一段脚本代码
    public static void runScript(String script)
    {
		try
		{
			StringReader reader = new StringReader(script);
            runScript( "New script", reader);
        }
        catch(Exception ex)
        {
			ex.printStackTrace();
			System.out.println(ex);
            return;
        }
    }
    public static void runScript(String scriptInfo, Reader reader)
    {
        Interpreter interpreter = new Interpreter(reader,System.out,System.out,true,namespace);
        try
        {
            if(notepad != null)
            {
                JTextComponent editor = notepad.getEditor();
interpreter.set("application",notepad); //将应用程序的变量传入解释器，                
interpreter.set("editor", editor);	    //这样就可在脚本中使用这个变量参照
            running = true;
            interpreter.eval(reader, namespace, scriptInfo);
			}
        }
        catch(Throwable throwable)
        {
			throwable.printStackTrace();
			JOptionPane.showMessageDialog(notepad,
							new Object[]
							{"Script 错误!",
							throwable.getMessage()},
							"错误",JOptionPane.ERROR_MESSAGE);
        }
        finally
        {
            running = false;
        }
    }
	public static boolean isMacroRunning()
	{
		return running;
	}
}
</PRE></TD></TR></TBODY></TABLE><BR>
<P>这个BeanShell提供了三个方法，<BR>void initBeanShell(Notepad)，这个方法进行初始化。<BR>void 
runScript(String script)，这个方法可直接运行脚本代码。<BR>void runScript(String scriptInfo, 
Reader reader)，这个方法可从一个Reader流中运行脚本。<BR>而真正核心的执行脚本的代码在void runScript(String 
scriptInfo, Reader reader)方法中，大家注意,代码中先创建了一个BeanShell的解释器实例，</P>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR>
<TD class=code-outline><PRE class=displaycode>Interpreter interpreter = new  Interpreter(reader,System.out,System.out,true,namespace);
</PRE></TD></TR></TBODY></TABLE><BR>
<P>然后将Notepad程序的实例变量传入解释器，这样就可直接在脚本中引用Notedpad的实例了，</P>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR>
<TD class=code-outline><PRE class=displaycode>JTextComponent editor = notepad.getEditor();
interpreter.set("application",notepad); //将应用程序的变量传入解释器，                
interpreter.set("editor", editor);	    //这样就可在脚本中使用这个变量参照
</PRE></TD></TR></TBODY></TABLE><BR>
<P>接下来看看如何把BeanShell嵌入到Notepad程序中，笔者写了几个类， Main，用来初始化，并在Notepad程序中加入一个"Script 
Editor"的菜单 ScriptEditor，简单的脚本编辑器，用来编辑或载入脚本，运行脚本程序。 ScriptEditorAction，启动Script 
Editor的Action.</P>
<P>下面是Main.class的主要代码，</P>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR>
<TD class=code-outline><PRE class=displaycode>		Notepad notepad = new Notepad();
		JMenu editMenu = new JMenu("Script Editor");
		JMenuItem editItem = new JMenuItem();
		editMenu.add(editItem);
		editItem.setAction(new ScriptEditorAction(notepad));
		notepad.getMenubar().add(editMenu);
</PRE></TD></TR></TBODY></TABLE><BR>
<P>以上程序取得Notepad程序的Menu Bar,并添加一个Script 
Editor菜单到其中，这样，就可不用修改Notepad程序，并在其中加入启动Script Editor的菜单。</P>
<P>下图是程序运行中的画面：</P><BR><BR><IMG height=700 alt="" src="1.gif" width=694> <BR>
<P>这个程序的完整代码，请在文章未尾的<A href="http://www-128.ibm.com/developerworks/cn/java/l-beanshell/index.html#resources">参考资料</A>中去下载。</P><BR>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR>
<TD><IMG height=1 alt="" src="blue_rule.gif" 
width="100%"><BR><IMG height=6 alt="" src="c.gif" width=8 
border=0></TD></TR></TBODY></TABLE>
<TABLE class=no-print cellSpacing=0 cellPadding=0 align=right>
<TBODY>
<TR align=right>
<TD><IMG height=4 alt="" src="c.gif" width="100%"><BR>
<TABLE cellSpacing=0 cellPadding=0 border=0>
<TBODY>
<TR>
<TD vAlign=center><IMG height=16 alt="" 
src="u_bold.gif" width=16 border=0><BR></TD>
<TD vAlign=top align=right><A class=fbox 
href="http://www-128.ibm.com/developerworks/cn/java/l-beanshell/index.html#main"><B>回页首</B></A></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE><BR><BR>
<P><A name=7><SPAN class=atitle>写一个简单的脚本</SPAN></A></P>
<P>现在我们写一个简单的脚本代码，用来统计某个单词在Notepad文章中的出现次数，下面列出这个脚本的代码：</P>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR>
<TD class=code-outline><PRE class=displaycode>/**
 * 字串统计程序。
 * @author: turbo chen
 */
//字串统计函数
counter(s)
{
	str = editor.getText();
	str = str.toLowerCase();
	slen = s.length();
	s = s.toLowerCase();
	count = 0;
	from = 0;
	while ( (from=str.indexOf(s,from))&gt;-1 )
	{
		count = count + 1;
		from = from + slen;
	}
	return count;
}
// application 是经由BeanShell传入的应用程序对象。
target = JOptionPane.showInputDialog(application,"Please input the count target:");
if ( target != null )
{
	count = counter(target);
	JOptionPane.showMessageDialog(application,"Found "+count+" targets.");	
}
</PRE></TD></TR></TBODY></TABLE><BR>
<P>将上面的脚本输入到"Script Editor"视窗中，运行它。看看程序运行的画面:</P><BR><BR><IMG height=160 alt="" 
src="2.gif" width=367> <BR>
<P>(查找"of"这个单词在文章中出现的次数,)</P><BR><BR><IMG height=145 alt="" src="3.gif" 
width=336> <BR>
<P>(找到13个目标。)</P><BR>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR>
<TD><IMG height=1 alt="" src="blue_rule.gif" 
width="100%"><BR><IMG height=6 alt="" src="c.gif" width=8 
border=0></TD></TR></TBODY></TABLE>
<TABLE class=no-print cellSpacing=0 cellPadding=0 align=right>
<TBODY>
<TR align=right>
<TD><IMG height=4 alt="" src="c.gif" width="100%"><BR>
<TABLE cellSpacing=0 cellPadding=0 border=0>
<TBODY>
<TR>
<TD vAlign=center><IMG height=16 alt="" 
src="u_bold.gif" width=16 border=0><BR></TD>
<TD vAlign=top align=right><A class=fbox 
href="http://www-128.ibm.com/developerworks/cn/java/l-beanshell/index.html#main"><B>回页首</B></A></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE><BR><BR>
<P><A name=8><SPAN class=atitle>总结</SPAN></A></P>
<P>本文讲解了BeanShell脚本引擎如何在现有的应用程序中应用，也让读者了解到BeanShell脚本的基本特性与脚本语法，让大家看到嵌入脚本引擎到Java应用程序中是多么的容易。</P><BR>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR>
<TD><IMG height=1 alt="" src="blue_rule.gif" 
width="100%"><BR><IMG height=6 alt="" src="c.gif" width=8 
border=0></TD></TR></TBODY></TABLE>
<TABLE class=no-print cellSpacing=0 cellPadding=0 align=right>
<TBODY>
<TR align=right>
<TD><IMG height=4 alt="" src="c.gif" width="100%"><BR>
<TABLE cellSpacing=0 cellPadding=0 border=0>
<TBODY>
<TR>
<TD vAlign=center><IMG height=16 alt="" 
src="u_bold.gif" width=16 border=0><BR></TD>
<TD vAlign=top align=right><A class=fbox 
href="http://www-128.ibm.com/developerworks/cn/java/l-beanshell/index.html#main"><B>回页首</B></A></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE><BR><BR>
<P><A name=9><SPAN class=atitle>例程下载</SPAN></A></P>
<P><A href="http://www-128.ibm.com/developerworks/cn/java/l-beanshell/Notepad.jar">notepad.rar</A>包括了本文示例中的所有源码。</P><BR><BR>
<P><A name=resources><SPAN class=atitle>参考资料 </SPAN></A></P>
<UL>
<LI>这儿有一个作者翻译的BeanShell的中文简介: <A 
href="http://www.csdn.net/develop/read_article.asp?id=15090">http://www.csdn.net/develop/read_article.asp?id=15090</A> 
<BR><BR>
<LI>BeanShell的完整在线教程： <A 
href="http://www.beanshell.org/manual/contents.html">http://www.beanshell.org/manual/contents.html</A> 
<BR><BR>
<LI>你也可以直接到BeanShell的首页下载最新的BeanShell引擎： <A 
href="http://www.beanshell.org/">http://www.beanshell.org/</A> <BR><BR>
<LI>如果想了解BeanShell与其它几种脚本语言之间的评测文章，可以点击下面的链接： <A 
href="http://tech.enet.com.cn/document/20020521/20020521154519011.shtml">http://tech.enet.com.cn/document/20020521/20020521154519011.shtml</A> 
<BR></LI></UL><BR><BR>
<P><A name=author><SPAN class=atitle>关于作者</SPAN></A></P>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR>
<TD colSpan=3><IMG height=5 alt="" src="c.gif" 
width="100%"></TD></TR>
<TR vAlign=top align=left>
<TD>
<P></P></TD>
<TD><IMG height=5 alt="" src="c.gif" width=4></TD>
<TD width="100%">
<P>陈先波(turbochen)是赛微科技公司(<A 
href="http://www.sunwaysoft.com/">www.sunwaysoft.com</A>)的Java开发员，有将近三年的Java开发经验，主要致力于Java技术在质量信息系统(QIS)中的应用，请通过<A 
href="mailto:turbochen@163.com%3Fcc=turbochen@163.com">turbochen@163.com</A>与作者联系。</P></TD></TR></TBODY></TABLE><BR><BR><BR>
<P class=no-print><SPAN class=atitle><A name=rate>对本文的评价</A></SPAN></P><SPAN 
class=no-print>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR vAlign=top>
<TD>
<FORM action=https://www.ibm.com/developerworks/secure/cnratings.jsp 
method=get><INPUT type=hidden value=为Java应用程序加入脚本引擎 name=ArticleTitle><INPUT 
type=hidden value="Java technology" name=Zone><INPUT type=hidden 
value=http://www.ibm.com/developerworks/cn/thankyou/ name=RedirectURL><INPUT 
type=hidden value=china name=localsite>
<SCRIPT language=javascript>document.write('<input type="hidden" name="url" value="'+location.href+'">');</SCRIPT>
<INPUT type=hidden 
value=http://www-128.ibm.com/developerworks/cn/java/l-beanshell/index.html 
name=url>
<TABLE cellSpacing=0 cellPadding=0 border=0>
<TBODY>
<TR>
<TD><IMG height=8 alt="" src="c.gif" width=100 
border=0></TD></TR>
<TR vAlign=top>
<TD><INPUT type=radio value=1 name=Rating>太差！ (1)</TD></TR>
<TR vAlign=top>
<TD><INPUT type=radio value=2 name=Rating>需提高 (2)</TD></TR>
<TR vAlign=top>
<TD><INPUT type=radio value=3 name=Rating>一般；尚可 (3)</TD></TR>
<TR vAlign=top>
<TD><INPUT type=radio value=4 name=Rating>好文章 (4)</TD></TR>
<TR vAlign=top>
<TD><INPUT type=radio value=5 
name=Rating>真棒！(5)</TD></TR></TBODY></TABLE><BR><B>建议？</B><BR><TEXTAREA id=Comments name=Comments rows=5 wrap=virtual cols=60>&nbsp;</TEXTAREA><BR><BR><INPUT type=submit value=反馈意见></FORM></TD></TR>
<TR vAlign=top>
<TD bgColor=#ffffff><IMG height=8 alt="" src="c.gif" 
width=100 border=0></TD></TR></TBODY></TABLE></SPAN><SPAN class=no-print>
<TABLE cellSpacing=0 cellPadding=0 align=right>
<TBODY>
<TR align=right>
<TD><IMG height=8 alt="" src="c.gif" width="100%"><BR>
<TABLE cellSpacing=0 cellPadding=0 border=0>
<TBODY>
<TR>
<TD vAlign=center><IMG height=16 alt="" 
src="u_bold.gif" width=16 border=0><BR></TD>
<TD vAlign=top align=right><A class=fbox 
href="http://www-128.ibm.com/developerworks/cn/java/l-beanshell/index.html#main"><B>回页首</B></A></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE><BR><BR></SPAN></TD>
<TD width=10><IMG height=1 alt="" src="c.gif" 
width=10></TD></TR></TBODY></TABLE><SPAN class=small>IBM 公司保留在 developerWorks 
网站上发表的内容的著作权。未经IBM公司或原始作者的书面明确许可，请勿转载。如果您希望转载，请通过 <A 
href="https://www.ibm.com/developerworks/secure/reprintreq.jsp?domain=dwchina">提交转载请求表单</A> 
联系我们的编辑团队。</SPAN></TD></TR></TBODY></TABLE><!--FOOTER_BEGIN--><BR>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR>
<TD class=bbg height=19>
<TABLE cellSpacing=0 cellPadding=0 border=0>
<TBODY>
<TR>
<TD><SPAN class=spacer>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><A class=mainlink 
href="index.shtml">关于 IBM</A></TD>
<TD class=footer-divider width=27>&nbsp;&nbsp;&nbsp;&nbsp;</TD>
<TD><A class=mainlink 
href="index.shtml">隐私条约</A></TD>
<TD class=footer-divider width=27>&nbsp;&nbsp;&nbsp;&nbsp;</TD>
<TD><A class=mainlink href="http://www.ibm.com/contact/">联系 
IBM</A></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
<SCRIPT language=JavaScript1.2 src="stats.js" 
type=text/javascript></SCRIPT>
<NOSCRIPT><img border="0" alt="" height="1" width="1" src="uc.GIF_R=noscript"/></NOSCRIPT><!--FOOTER_END--><!--XSLT stylesheet used to transform this file:  dw-document-html-5.5.1.xsl--><!--EndFragment--></BODY>
</HTML>