<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0074)http://www.javaresearch.org/article/showarticle.jsp?column=23&thread=10956 -->
<HTML><HEAD><TITLE>让你的struts能处理日期类型</TITLE>
<META http-equiv=Content-Type content="text/html; charset=gb2312"><LINK 
href="zaxis.css" rel=stylesheet>
<SCRIPT language=JavaScript src=""></SCRIPT>

<META content="MSHTML 6.00.2800.1170" name=GENERATOR></HEAD>
<BODY text=#000000 bgColor=#f1f1f1 leftMargin=0 topMargin=2><!-- start of header row -->
<TABLE height=64 cellSpacing=0 cellPadding=0 width=762 align=center border=0>
  <TBODY>
  <TR>
    <TD bgColor=#000000 colSpan=3 height=1></TD></TR>
  <TR>
    <TD width=1 bgColor=#000000><IMG height=1 src="" width=1></TD>
    <TD width=760 height=64>
      <TABLE height=64 cellSpacing=0 cellPadding=0 width="100%" align=center 
      border=0>
        <TBODY>
        <TR bgColor=#ffffff>
          <TD vAlign=center align=left width=180><A 
            href="http://www.javaresearch.org/index.jsp"><IMG 
            src="logo.gif" border=0></A></TD>
          <TD vAlign=center align=middle width=468 height=60>
            <CENTER><IFRAME marginWidth=0 marginHeight=0 src="about_blank" 
            frameBorder=0 width=468 scrolling=no height=60 
            valign="bottom">				
					</IFRAME></CENTER></TD>
          <TD vAlign=center align=right width=120><BR>2003年12月10日<BR><A 
            href="http://www.javaresearch.org/login.jsp"><FONT 
            color=black>登录/注册</FONT></A> </TD></TR></TBODY></TABLE>
      <TABLE height=21 cellSpacing=1 cellPadding=0 width="100%" bgColor=#995f14 
      border=0>
        <TBODY>
        <TR bgColor=#006699>
          <TD bgColor=#000000>
            <P align=right><FONT 
            color=#ffffff>[&nbsp;Java原创社区，当前在线：488&nbsp;]</FONT>&nbsp;&nbsp;&nbsp;&nbsp; 
            <A href="http://www.javaresearch.org/index.jsp"><FONT 
            color=#ffffff>首页</FONT></A><FONT color=#ffffff> | </FONT><A 
            href="http://www.javaresearch.org/news"><FONT 
            color=#ffffff>Java新闻</FONT></A><FONT color=#ffffff> | </FONT><A 
            href="http://www.javaresearch.org/article"><FONT 
            color=#ffffff>研究文集</FONT></A><FONT color=#ffffff> | </FONT><A 
            href="http://www.javaresearch.org/forum"><FONT 
            color=#ffffff>专题论坛</FONT></A><FONT color=#ffffff> | </FONT><A 
            href="http://javaresearch.gro.clinux.org/index.html" 
            target=_blank><FONT color=#ffffff>开源软件</FONT></A><FONT 
            color=#ffffff> | </FONT><A 
            href="http://www.javaresearch.org/jrworks.jsp"><FONT 
            color=#ffffff>JR 作品</FONT></A><FONT color=#ffffff> | </FONT><A 
            href="http://www.javaresearch.org/dn.jsp"><FONT 
            color=#ffffff>精品下载</FONT></A><FONT color=#ffffff> | </FONT><A 
            href="http://www.javaresearch.org/source/index.html" 
            target=_blank><FONT color=#ffffff>在线代码</FONT></A><FONT 
            color=#ffffff> | </FONT><A 
            href="http://www.javaresearch.org/aboutus.jsp"><FONT 
            color=#ffffff>关于我们</FONT></A><FONT color=#ffffff>&nbsp;&nbsp; 
            </FONT></P></TD></TR></TBODY></TABLE></TD>
    <TD width=1 bgColor=#000000><IMG height=1 src="" 
width=1></TD></TR></TBODY></TABLE><!-- start of news row -->
<TABLE height=180 cellSpacing=0 cellPadding=0 width=762 align=center border=0>
  <TBODY>
  <TR>
    <TD width=1 bgColor=#000000 height=180><IMG height=1 src="" width=1></TD><!--right column-->
    <TD vAlign=top width=760 bgColor=#ffffff height=180>
      <DIV align=center>
      <TABLE height=5 cellSpacing=0 cellPadding=0 width="100%" border=0><!--space-->
        <TBODY>
        <TR>
          <TD align=middle width="95%"><!-- content begin -->
            <TABLE cellSpacing=2 cellPadding=0 width="100%" border=0>
              <TBODY>
              <TR>
                <TD align=left width="50%"><B><A 
                  href="http://www.javaresearch.org/index.jsp">首页</A> &raquo; <A 
                  href="http://www.javaresearch.org/article/index.jsp">研究文集</A> 
                  &raquo; <A 
                  href="http://www.javaresearch.org/article/column.jsp?column=23">Apache项目区</A> 
                  </B></TD>
                <TD align=right width="50%"><A 
                  href="http://www.javaresearch.org/article/postarticle.jsp?column=23&amp;thread=10956&amp;reply=true"><IMG 
                  height=17 alt=评论此文章 src="reply.gif" 
                  width=17 border=0></A>&nbsp;<A class=title 
                  title="Click to reply to this topic" 
                  href="http://www.javaresearch.org/article/postarticle.jsp?column=23&amp;thread=10956&amp;reply=true">发表评论</A> 
<!--
&nbsp;&nbsp;<a href="file:///J:/search.jsp?column=23"><img src="search.gif" width="17" height="17" alt="搜索栏目" border="0"></a>&nbsp;<a href="file:///J:/search.jsp?column=23" class="title" title="搜索栏目">搜索文章</a> --></TD></TR></TBODY></TABLE>
            <TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
              <TBODY>
              <TR>
                <TD><!-- start of article title -->
                  <TABLE cellSpacing=0 cellPadding=0 width="100%" 
                  bgColor=#ffffff border=0>
                    <TBODY>
                    <TR>
                      <TD class=title1 align=middle width="100%" bgColor=#eeeeee 
                      colSpan=3 height=40><B>让你的struts能处理日期类型</B></TD></TR>
                    <TR>
                      <TD align=middle width="100%" bgColor=#eeeeee><A 
                        href="http://www.javaresearch.org/profile.jsp?user=1868">javamonkey</A> 
                        原创&nbsp; (参与分：436，专家分：380)&nbsp;&nbsp; 发表：2003-12-6 
                        下午5:40 &nbsp;&nbsp;更新：2003-12-8 上午8:54 
                        &nbsp;&nbsp;版本：1.0 
                    &nbsp;&nbsp;阅读：<B>216</B>次</TD></TR></TBODY></TABLE></TD></TR><!-- end of article title -->
              <TR>
                <TD vAlign=top align=middle width="100%"><!--start of article content -->
                  <TABLE width="98%" border=0>
                    <TBODY>
                    <TR>
                      <TD class=text align=left width="100%"><BR>在<A 
                        href="http://www.javaresearch.org/forum/thread.jsp?column=20&amp;thread=9712" 
                        target=_blank>http://www.javaresearch.org/forum/thread.jsp?column=20&amp;thread=9712</A>中有不少朋友问如何让struts处理日期类型，我现在在这儿综合回答一下，希望能提供struts开发人员效率。<BR>struts使用日期包括将string自动转化为日期fill到form中，以及将form中的日期按照指定格式显示在html的textfield中。首先讲第一种情况的解决方法：<BR><BR>创建如下类：<BR><PRE><BR><B>import</B> java.util.*;<BR><B>import</B> org.apache.commons.beanutils.*;<BR><B>import</B> java.text.SimpleDateFormat;<BR><BR><B>public</B> <B>class</B> DateConvert <B>implements</B> Converter<BR>{<BR>  <B>static</B> SimpleDateFormat df = <B>new</B> SimpleDateFormat(<FONT color=#000099>"yyyy/MM/dd"</FONT>);<BR>  <B>public</B> DateConvert()<BR>  {<BR><BR>  }<BR>  <B>public</B> Object convert(Class type, Object value)<BR>  {<BR>    <BR>    <B>if</B>(value==null)<B>return</B> null;<BR>    <B>if</B>(((String)value).trim().length()==0) <B>return</B> null;<BR><BR>    <B>if</B>(value <B>instanceof</B> String)<BR>    {<BR>      <B>try</B><BR>      {<BR>        <B>return</B> df.parse((String)value);<BR>      }<BR>      <B>catch</B> (Exception ex)<BR>      {<BR>        <B>throw</B> <B>new</B> ConversionException(<FONT color=#000099>"输入的日期类型不合乎yyyy/MM/dd"</FONT><BR>          + value.getClass());<BR>      }<BR><BR>    }<BR>    <B>else</B><BR>    {<BR>      <B>throw</B> <B>new</B> ConversionException(<FONT color=#000099>"输入的不是字符类型"</FONT>+value.getClass());<BR>    }<BR><BR>  }<BR>}<BR></PRE><BR><BR><BR>然后在你的系统某出使用如下（如web的init方法）<BR>ConvertUtils.register(new 
                        DateConvert(),java.util.Date.class);<BR>参数用于表示DateConvert类负责处理java.util.Date类型的转化<BR><BR>第二种情况是如何显示form中日期类型到html:text中，我用的办法是修改struts的代码，重新生成一个新的struts.jar<BR>org.apache.struts.taglib.html.BaseFieldTag的doStartTag的方法<BR>找到 
                        if (value != null) 
                        {results.append(ResponseUtils.filter(value))代码行下面的内容，需要修改此处代码，以便输出日期类型<BR>如下：<BR><BR><PRE><BR><B>if</B> (value != null) {<BR>            results.append(ResponseUtils.filter(value));<BR>        } <B>else</B> <B>if</B> (redisplay || !<FONT color=#000099>"password"</FONT>.equals(type)) {<BR>            Object value = RequestUtils.lookup(pageContext, name, property, null);<BR>            <FONT color=#006600><I>//System.out.println("lijz "+value);</FONT></I><BR>            <B>if</B>(value <B>instanceof</B> java.util.Date)<BR>            {<BR>           	<FONT color=#006600><I>//System.out.println("date="+value);</FONT></I><BR>           	<B>if</B> (value == null)<BR>                   value = <FONT color=#000099>""</FONT>;<BR>		<B>else</B><BR>		{<BR>		  java.util.Date d= (java.util.Date)value;<BR>		  <B>try</B><BR>	 	  {<BR><BR>			results.append(ResponseUtils.filter(df.format(d)));<BR>		  }<BR>		  <B>catch</B>(Exception ex)<BR>		  {<BR>			System.out.println(<FONT color=#000099>"form error:"</FONT>+ex.getMessage());<BR>		  }<BR>	      }<BR>            }<BR>           <B>else</B><BR>           {<BR>           	<B>if</B> (value == null)<BR>                value = <FONT color=#000099>""</FONT>;<BR>                results.append(ResponseUtils.filter(value.toString()));<BR>           }<BR>           <BR>       }<BR>        results.append(<FONT color=#000099>"\""</FONT>);<BR>        results.append(prepareEventHandlers());<BR>        results.append(prepareStyles());<BR>        results.append(getElementClose());<BR><BR>        <FONT color=#006600><I>// Print this field to our output writer</FONT></I><BR>        ResponseUtils.write(pageContext, results.toString());<BR><BR>        <FONT color=#006600><I>// Continue processing this page</FONT></I><BR>        <B>return</B> (EVAL_BODY_TAG);<BR>        <BR></PRE><BR><BR><BR>重新编译struts成struts.jar.放到你需要的项目中<BR><BR><BR>原理不用多说，看看struts源代码就明白了 
                        ：）<BR>希望能提高大家的开发效率<BR><BR><BR><BR>
                        <TABLE width="100%">
                          <TBODY>
                          <TR>
                            <TD align=left width="30%"><A 
                              href="http://www.javaresearch.org/copyright.jsp">版权声明</A> 
                              &nbsp; <A 
                              href="mailto:javamonkey@163.com">给作者写信</A> </TD>
                            <TD align=right width="70%">
                              <TABLE cellPadding=1 align=right>
                                <TBODY>
                                <TR>
                                <TD bgColor=#eeeeee>
                                <TABLE cellSpacing=0 cellPadding=1 border=0>
                                <TBODY>
                                <TR>
                                <TD bgColor=#ffffff><FONT 
                                color=#777777><NOBR>本篇文章对您是否有帮助？&nbsp;&nbsp;投票：<STRONG> 
                                <A 
                                href="http://www.javaresearch.org/article/showarticle.jsp?column=23&amp;thread=10956&amp;vote=1">是</A></STRONG> 
                                &nbsp;&nbsp;&nbsp;<STRONG><A 
                                href="http://www.javaresearch.org/article/showarticle.jsp?column=23&amp;thread=10956&amp;vote=0">否</A></STRONG> 
                                &nbsp;&nbsp;&nbsp;&nbsp;投票结果：&nbsp;&nbsp; <IMG 
                                src="cool.gif"><STRONG>&nbsp;&nbsp;0</STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<IMG 
                                src="sad.gif"><STRONG>&nbsp;&nbsp;1</STRONG></NOBR><BR></FONT></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE><BR></TD></TR><!--end of article content -->
              <TR>
                <TD><!-- start of comment -->
                  <TABLE cellSpacing=2 cellPadding=0 width="100%" align=center 
                  border=0>
                    <TBODY>
                    <TR>
                      <TD vAlign=top noWrap width="30%"><A 
                        title=从Tomcat中得到更多－Tomcat的源码分析 
                        href="http://www.javaresearch.org/article/showarticle.jsp?column=23&amp;thread=3092"><IMG 
                        height=10 alt="Topic: 从Tomcat中得到更多－Tomcat的源码分析" hspace=2 
                        src="prev.gif" width=10 
                        border=0></A> <A class=title 
                        title="Topic: 从Tomcat中得到更多－Tomcat的源码分析" 
                        href="http://www.javaresearch.org/article/showarticle.jsp?column=23&amp;thread=3092">上一篇文章</A> 
                      </TD>
                      <TD align=middle width="40%">
                        <TABLE cellSpacing=2 cellPadding=0 border=0>
                          <TBODY>
                          <TR>
                            <TD><A 
                              href="http://www.javaresearch.org/article/column.jsp?column=23"><IMG 
                              height=12 alt=返回文章列表 
                              src="back_to.gif" width=12 
                              border=0></A></TD>
                            <TD noWrap><A class=title title=返回文章列表 
                              href="http://www.javaresearch.org/article/column.jsp?column=23">返回〔Apache项目区〕</A> 
                            </TD></TR></TBODY></TABLE></TD>
                      <TD vAlign=top noWrap width="30%"><A class=title 
                        title=怎样降低Struts中不需进行业务处理的性能损耗！ 
                        href="http://www.javaresearch.org/article/showarticle.jsp?column=23&amp;thread=7921">下一篇文章</A> 
                        <A title=怎样降低Struts中不需进行业务处理的性能损耗！ 
                        href="http://www.javaresearch.org/article/showarticle.jsp?column=23&amp;thread=7921"><IMG 
                        height=10 alt="Topic: 怎样降低Struts中不需进行业务处理的性能损耗！" 
                        hspace=2 src="next.gif" width=10 
                        border=0></A> </TD></TR></TBODY></TABLE><BR></TD></TR><!-- end of comment --><!--end of article --></TBODY></TABLE><!-- end of content --></TD></TR></TBODY></TABLE></DIV></TD>
    <TD width=1 bgColor=#000000 height=180><IMG height=1 src="" 
  width=1></TD></TR></TBODY></TABLE><!-- end of news row--><!--start of bottom row-->
<TABLE cellSpacing=0 cellPadding=0 width=762 align=center border=0>
  <TBODY>
  <TR>
    <TD width=1 bgColor=#000000><IMG height=1 src="" width=1></TD>
    <TD width=760><!--start sponsorlink-->
      <TABLE cellSpacing=0 cellPadding=0 width=760 border=0>
        <TBODY>
        <TR>
          <TD bgColor=#f2f2f2>
            <TABLE cellSpacing=0 cellPadding=0 width=740 align=center 
              border=0><TBODY>
              <TR>
                <TD vAlign=bottom height=3></TD></TR>
              <TR>
                <TD vAlign=bottom><B>文字广告链接</B></TD></TR></TBODY></TABLE></TD></TR>
        <TR>
          <TD align=middle bgColor=#f2f2f2>
            <TABLE cellSpacing=0 cellPadding=2 width=750 border=0>
              <TBODY>
              <TR>
                <TD align=middle bgColor=#000000 colSpan=2 height=1></TD></TR>
              <TR>
                <TD class=small align=right width="25%">华丹CHARISMA报表平台：</TD>
                <TD class=small width="75%"><A href="http://www.huadan.biz/" 
                  target=_blank>基于J2EE，MVC极速开发平台＋自定义Web报表引擎</A></TD></TR>
              <TR>
                <TD class=small align=right width="25%">明宇科技：</TD>
                <TD class=small width="75%"><A 
                  href="http://www.soft2web.com/?ad=1" 
                  target=_blank>Web报表+Java报表+.NET报表+Web打印+报表控件+Web套打+自定义报表</A></TD></TR>
              <TR>
                <TD class=small align=right width="25%">智岛软件：</TD>
                <TD class=small width="75%"><A 
                  href="http://www.oapro.com/ostarocx/product.asp" 
                  target=_blank>类似Word的控件，一网打尽文档处理、报表统计、电子表格和表单录入</A></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
      <TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
        <TBODY>
        <TR>
          <TD bgColor=#995f14 height=1><IMG height=1 src="" width=1></TD></TR>
        <TR>
          <TD bgColor=#0099cc height=20>
            <P align=center><A 
            href="http://www.javaresearch.org/aboutus.jsp"><FONT 
            color=#ffffff>关于 JR</FONT></A>&nbsp; |&nbsp; <A 
            href="http://www.javaresearch.org/copyright.jsp"><FONT 
            color=#ffffff>版权声明</FONT></A>&nbsp; |&nbsp; <A 
            href="mailto:webmaster@javaresearch.org"><FONT 
            color=#ffffff>联系我们</FONT></A>&nbsp; </P></TD></TR>
        <TR>
          <TD bgColor=#000000 height=20>
            <P align=center><FONT face="Arial, Helvetica, sans-serif" 
            color=#ffffff>&copy;2002-2003&nbsp;Java研究组织&nbsp;版权所有 </FONT></P></TD></TR>
        <TR>
          <TD bgColor=#995f14 height=1></TD></TR></TBODY></TABLE></TD>
    <TD width=1 bgColor=#000000><IMG height=1 src="" 
width=1></TD></TR></TBODY></TABLE><!--end of bottom row--></BODY></HTML>
