<HTML><HEAD>
<LINK href="/css/zaxis.css" rel=stylesheet>
<SCRIPT Language="JavaScript" SRC="util.js"></SCRIPT>
<TITLE>如何用jsp输出存在于oracle数据库Blob字段中的jpg图片</TITLE>
</HEAD>

<BODY text=#000000 bgColor=#F1F1F1 leftMargin=0 topMargin=2>


<!-- start of header row -->
<TABLE cellSpacing=0 cellPadding=0 width="762" height=64 border=0 align=center>
  <TBODY>
  <TR>
    <TD colspan=3 height=1 bgColor=#000000></TD>
  </TR>
  <TR>
    <TD width=1 bgColor=#000000>
    <IMG src="spacer.gif" width="1" height="1"></TD>
    
    <TD width=760 height=64>

	  <TABLE align="center" cellSpacing=0 cellPadding=0 width=100% border=0 height="64">
			<TR bgColor=#ffffff>
				<TD align="left" valign="center" width="180"><a href="file:///J:/index.jsp"><img src="logo.gif" border=0/></a></TD>
				<TD align="center" valign="center" width="468" height=60>
					<center><iframe src="topbanner.htm" width="468" height="60" valign=bottom marginwidth="0" marginheight="0" hspace="0" vspace="0" frameborder="0" scrolling="NO">				
					</iframe></center>
				</TD>
				<TD width="120" align=right valign=center><br>2003年12月26日<br>
				
				<a href="file:///J:/login.jsp"><font color=black>登录/注册</font></a>
				
				</TD>
			</TR>
	  </table>

      <TABLE cellSpacing=1 cellPadding=0 width="100%" height=21 bgColor=#995f14 
        border=0><TBODY>
        <TR bgColor=#006699>
		<TD bgcolor="#000000">
		<p align="right"><font color="#FFFFFF">[&nbsp;Java原创社区，当前在线：451，本次峰值：629&nbsp;]</font>&nbsp;&nbsp;&nbsp;&nbsp;
		<A href="file:///J:/index.jsp"><font color="#FFFFFF">首页</font></A><font color="#FFFFFF"> |
        </font> 
		<A href="file:///J:/news"><font color="#FFFFFF">Java新闻</font></A><font color="#FFFFFF"> |
        </font> 
		<A href="file:///J:/article"><font color="#FFFFFF">研究文集</font></A><font color="#FFFFFF"> |
        </font> 
		<A href="file:///J:/forum"><font color="#FFFFFF">专题论坛</font></A><font color="#FFFFFF"> |
        </font> 
		<A href="http://javaresearch.gro.clinux.org/index.html" target="_blank"><font color="#FFFFFF">开源软件</font></A><font color="#FFFFFF"> |
        </font> 
		<A href="file:///J:/jrworks.jsp"><font color="#FFFFFF">JR 作品</font></A><font color="#FFFFFF"> |
        </font> 
		<A href="file:///J:/dn.jsp"><font color="#FFFFFF">精品下载</font></A><font color="#FFFFFF"> |
        </font> 
		<A href="file:///J:/aboutus.jsp"><font color="#FFFFFF">关于我们</font></A><font color="#FFFFFF">&nbsp;&nbsp;
        </font>		
		</TD></TR></TBODY></TABLE>

	</TD>
	
    <TD width=1 bgColor=#000000><IMG height=1 
      src="spacer.gif" width=1></TD>
    </TR></TBODY></TABLE>



<!-- start of news row -->
<TABLE cellSpacing=0 cellPadding=0 width="762" border=0 height="180" align=center>
  <TBODY>
  <TR>
    <TD width=1 bgColor=#000000 height="180"><IMG height=1 
      src="spacer.gif" width=1></TD>
      
    <!--right column-->
    <TD vAlign=top width=760 bgColor=#ffffff height="180">
      <DIV align=center>
      <TABLE height=5 cellSpacing=0 cellPadding=0 width=100% border=0><!--space-->
        <TBODY>
        <TR><TD width=95% align=center>
		<!-- content begin -->

<table cellpadding="0" cellspacing="2" border="0" width=100%>
<tr>
<td width=50% align=left>
<b>
<a href="file:///J:/index.jsp">首页</a>
&raquo;
<a href="file:///J:/article/index.jsp">研究文集</a>
&raquo;
<a href="file:///J:/技巧_CHM/J2EE/column.jsp?column=106">JSP/Servlet</a>
</b>
</td>
<td width=50% align="right">
<a href="file:///J:/技巧_CHM/J2EE/postarticle.jsp?column=106%26thread=11417%26reply=true"><img src="reply.gif" width="17" height="17" alt="评论此文章" border="0"></a>&nbsp;<a href="file:///J:/技巧_CHM/J2EE/postarticle.jsp?column=106%26thread=11417%26reply=true" class="title" title="Click to reply to this topic">发表评论</a>
<!--
&nbsp;&nbsp;<a href="file:///J:/search.jsp?column=106"><img src="search.gif" width="17" height="17" alt="搜索栏目" border="0"></a>&nbsp;<a href="file:///J:/search.jsp?column=106" class="title" title="搜索栏目">搜索文章</a> -->

</td>
</tr>
</table>

<table cellSpacing=0 cellPadding=0 width=100% border=0>
  <tbody>
  <tr><td><!-- start of article title -->




      <TABLE cellSpacing=0 cellPadding=0 width=100% bgColor=#ffffff border=0>
        <TBODY>
        <TR>
          <TD class="title1" colspan="3" align="center" height="40" width="100%"  bgColor=#eeeeee><B>如何用jsp输出存在于oracle数据库Blob字段中的jpg图片</B></TD>
		</TR>
        <TR>
          <TD align="middle" bgColor=#eeeeee width=100%>
          		
				<a href="file:///J:/profile.jsp?user=42222">Jagie</a>
			
			原创&nbsp;
			
			(参与分：209，专家分：880)&nbsp;&nbsp;
			
			发表：2003-12-23 下午5:47
			
			
			
				&nbsp;&nbsp;版本：1.0		
			
		 &nbsp;&nbsp;阅读：<b>211</b>次</TD>
		</TR>
		</TBODY></TABLE>
  </td></tr><!-- end of article title -->
  <tr><TD vAlign=top align=center width=100%><!--start of article content -->
      <TABLE width=98% border=0>
        <TBODY>
        <TR>
          <TD align=left width=100% class="text"><br>

			
				<BR>关键字:jsp,Blob<BR><BR><BR>在web-oa系统中,档案管理好象不可或缺。其中员工照片常常做成这样:用户通过浏览器上传员工相片,服务端程序接收图片文件,保存到数据库中的某个表的Blob字段里(关于文件上传和blob字段的更新,请参考http://www.javaresearch.org/article/showarticle.jsp?column=106&thread=11003和http://forum.hibernate.org.cn/viewtopic.php?t=254)。通过(jdbc/jdo)和(jsp/servlet),服务器再把保存在Blob字段中的图片文件展现给用户。我这里给出一个关于展现的简单例子。<BR><BR>1.在数据库中建表，并且表要包含Blob字段。<BR>2.用plsql developer这种客户端数据库工具,修改某条记录的Blob字段,存入一个jpg文件。<BR>3.用jdbc或者hibernate获取某条记录的Blob字段数据。(请参考参考资料2)<BR>4.写一个jsp文件,来输出图片。如下所示<BR><BR>//////////////////////cwry_pic.jsp/////////////////////////<BR>&lt;%@page import="java.io.*"%&gt;<BR>&lt;%@page import="com.jagie.business.profile.*" %&gt;<BR>&lt;%@page import="java.sql.Blob"%&gt;<BR>&lt;%<BR>response.reset();<BR>//这个设置很重要,否则客户端浏览器不能识别输出内容,导致弹出下载的对话框。<BR>response.setContentType("image/jpeg");<BR>ServletOutputStream sos = response.getOutputStream();<BR>//这里是用hibernate来根据id装载对象,你可以用别的方式如jdbc来组装对象,附文中有<BR>//BaseInfo这个javabean的示意性代码.<BR>BaseInfo bif= ProFileOperator.loadProFile(Long.valueOf("1"));<BR>//输出图片<BR>if(bif!=null&&bif.getPic()!=null){<BR>  Blob blob=(Blob)bif.getPic();<BR>  InputStream pi = blob.getBinaryStream();<BR>  int blobsize = (int)blob.length();<BR>  byte[] blobbytes = new byte[blobsize];<BR>  int bytesRead = 0;<BR>  while ((bytesRead = pi.read(blobbytes)) != -1) {<BR>	sos.write(blobbytes, 0, bytesRead);<BR>  }<BR>pi.close();<BR>sos.flush();<BR>}<BR>%&gt;<BR><BR>发布这个jsp到你的web服务器,再用浏览器访问这个jsp页面，你就可以看到保存在Blob字段中的图片了。<BR><BR><BR>附文:<BR><BR>///////////////////BaseInfo.java示意性代码///////////////////////<BR>package com.jagie.business.profile;<BR>public class BaseInfo{<BR>  //pk<BR>  private Long id;<BR>  //相片<BR>  private java.sql.Blob pic;<BR>  public Long getId() {<BR>    return id;<BR>  }<BR>  public void setId(Long id) {<BR>    this.id = id;<BR>  }   <BR><BR>  public java.sql.Blob getPic() {<BR>    return pic;<BR>  }<BR>  public void setPic(java.sql.Blob pic) {<BR>    this.pic = pic;<BR>  }<BR>}<BR><BR>最后，希望这篇文章能对你有所启发，如有错误,敬请批评指正!<BR><BR><BR>参考资料:<BR>1:http://www-900.ibm.com/developerWorks/cn/java/l-imgtxt/index.shtml<BR>2:http://forum.hibernate.org.cn/viewtopic.php?t=254
			
			
<br><br>

			<table width=100%>
			<tr><td align=left width=30%>
			<a href="file:///J:/copyright.jsp">版权声明</a>
			  
				 &nbsp;
				<a href="mailto:chen_cwf@163.com">给作者写信</a>
			  
			</td>
			<td align=right width=70%>
			<table width="" align=right cellpadding="1"><tr><td bgcolor="#eeeeee">
			<table cellpadding="1" cellspacing="0" border="0"><tr><td bgcolor="#ffffff">
			<font color="#777777">
			<nobr>本篇文章对您是否有帮助？&nbsp;&nbsp;投票：<strong>
			<a href="file:///J:/article/showarticle.jsp?column=106%26thread=11417%26vote=1">是</a></strong>
			&nbsp;&nbsp;&nbsp;<strong><a href="file:///J:/article/showarticle.jsp?column=106%26thread=11417%26vote=0">否</a></strong>
			&nbsp;&nbsp;&nbsp;&nbsp;投票结果：&nbsp;&nbsp; <img src="cool.gif" /><strong>&nbsp;&nbsp;3</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="sad.gif" /><strong>&nbsp;&nbsp;0</strong></nobr><br></font>
			</td></tr></table>
			</td></tr></table>
			</td></tr>
			</table>
		</TD>
		</TR>
		</TBODY>
	  </TABLE><BR>
  </td></tr><!--end of article content -->

  <tr><td><!-- start of comment -->

<br>    
<table cellpadding="0" cellspacing="0" border="0" width="100%" align="center">
<tr>
	<td>
    <table cellpadding="0" cellspacing="0" border="0" align=center width="98%">
    <tr bgcolor="#eeeeee">
        <td width="60%">


			&nbsp;&nbsp;评论人：<a href="file:///J:/profile.jsp?user=42222" title="Jagie"
             ><b>Jagie</b></a>
            
            &nbsp;&nbsp;&nbsp;参与分: 209
            &nbsp;&nbsp;&nbsp;专家分: 880
            
            &nbsp;&nbsp;&nbsp;来自: 北京<br>
            

		</td>
        <td width="40%" nowrap>
        发表时间: 2003-12-24 上午10:17

        </td>

    </tr>
    <tr>
        <td colspan="2" valign="top">
        <font size="-1" face="arial,sans-serif" />

    如果你想把这个显示图片的jsp作为一个普通的img html标签来用，你可以在某个页面（如员工档案页面）里面加上这么一句:<BR><BR>&lt;img src="cwry_pic.jsp?id=&lt;%= bif.getId() %&gt;" width="150" height="200" onDblClick="openwin(&lt;%= bif.getId() %&gt;)"&gt;

        </td>
    </tr>
    </table>
</td></tr>
</table>
	



<br>
<table bgcolor="#cccccc"
 cellpadding="1" cellspacing="0" border="0" width="100%" align="center">
<tr>
    <td>
<table bgcolor="#eeeeee"
 cellpadding="3" cellspacing="0" border="0" width="100%" align="center">
<tr><td>
    这个文章共有 <b>1</b> 条评论，共 <b>1</b> 页
    

    </td>
</tr>
</table>
    </td>
</tr>
</table>




<table cellpadding="0" cellspacing="2" border="0" width="100%" align="center">
<tr>
    <td width="30%" nowrap valign="top">

    <a href="file:///J:/技巧_CHM/J2EE/showarticle.jsp?column=106%26thread=11455"
     title="Struts 初学指南"><img src="prev.gif" width="10" height="10" hspace="2" alt="Topic: Struts 初学指南" border="0"></a>
    <a href="file:///J:/技巧_CHM/J2EE/showarticle.jsp?column=106%26thread=11455"
     class="title" title="Topic: Struts 初学指南">上一篇文章</a>

    </td>
    <td width="40%" align="center">
    
<table cellpadding="0" cellspacing="2" border="0">
<tr>
	<td><a href="file:///J:/技巧_CHM/J2EE/column.jsp?column=106"><img src="back_to.gif" width="12" height="12" alt="返回文章列表" border="0"></a></td>
	<td nowrap>
        <a href="file:///J:/技巧_CHM/J2EE/column.jsp?column=106" class="title" title="返回文章列表">返回〔JSP/Servlet〕</a>
    </td>
</tr>
</table>
    
    </td>
    <td width="30%" nowrap valign="top">

    <a href="file:///J:/技巧_CHM/J2EE/showarticle.jsp?column=106%26thread=11241" class="title" 
     title="Portlet应用开发(Portlet Specs v1.0), Part 1">下一篇文章</a>
    <a href="file:///J:/技巧_CHM/J2EE/showarticle.jsp?column=106%26thread=11241"
     title="Portlet应用开发(Portlet Specs v1.0), Part 1"><img src="next.gif" width="10" height="10" hspace="2" alt="Topic: Portlet应用开发(Portlet Specs v1.0), Part 1" border="0"></a>

    </td>
</tr>
</table>
<br>

</td></tr><!-- end of comment -->
<!--end of article -->
</table>

		<!-- end of content -->
		</TD></TR>
        </TBODY>
      </TABLE>
      
      </DIV>
      
  
    </TD>
    
    <TD width=1 bgColor=#000000 height="180"><IMG height=1 
      src="spacer.gif" width=1></TD>
    
    </TR>
</TBODY></TABLE>
<!-- end of news row-->

<!--start of bottom row-->    
<TABLE cellSpacing=0 cellPadding=0 width="762" border=0 align=center>
  <TBODY>
  <TR>
    <TD width=1 bgColor=#000000><IMG height=1 
      src="spacer.gif" width=1></TD>
    <TD width=760>

      <!--start sponsorlink-->
  <table width="760" border="0" cellspacing="0" cellpadding="0">
  <tr> 
    <td bgcolor="#F2F2F2" > 
      <table width="740" border="0" cellspacing="0" cellpadding="0" align="center" >
        <tr>
          <td height="3" valign="bottom"></td>
        </tr>
        <tr> 
          <td valign="bottom"><b>文字广告链接</b></td>
        </tr>
      </table>
    </td>
  </tr>
  <tr>
    <td bgcolor="#F2F2F2" align="center">
      <table width="750" border="0" cellspacing="0" cellpadding="2">
        <tr> 
	      <td colspan=2 bgcolor="#000000" align="center" height="1"></td>
        </tr>
        <tr> 
          <td width="25%" align="right" class="small">华丹CHARISMA报表平台：</td>
          <td width="75%" class="small"><a href="http://www.huadan.biz/" target="_blank">基于J2EE，MVC极速开发平台＋自定义Web报表引擎</a></td>
        </tr>
        <tr> 
          <td width="25%" align="right" class="small">明宇科技：</td>
          <td width="75%" class="small"><a href="http://www.soft2web.com/?ad=1" target="_blank">Web报表+Java报表+.NET报表+Web打印+报表控件+Web套打+自定义报表</a></td>
        </tr>
        <tr> 
          <td width="25%" align="right" class="small">智岛软件：</td>
          <td width="75%" class="small"><a href="http://www.oapro.com/ostarocx/product.asp" target="_blank">类似Word的控件，一网打尽文档处理、报表统计、电子表格和表单录入</a></td>
        </tr>

      </table>
      </td>
      </tr>
   </table>
    
   
      <TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
        <TBODY>
        <TR>
          <TD bgColor=#995f14 height=1><IMG height=1 
            src="spacer.gif" width=1></TD></TR>
        <TR>
          <TD bgColor=#0099CC height=20>
            <p align="center"><a href="file:///J:/aboutus.jsp"><font color="#FFFFFF">关于 JR</font></a>&nbsp; |&nbsp; <a href="file:///J:/copyright.jsp"><font color="#FFFFFF">版权声明</font></a>&nbsp; 
            |&nbsp; <a href="mailto:webmaster@javaresearch.org"><font color="#FFFFFF">联系我们</font></a>&nbsp;
            </TD></TR>
        <TR>
          <TD bgColor=#000000 height=20>
            <p align="center"><FONT face="Arial, Helvetica, sans-serif" color=#ffffff>
            &copy;2002-2003&nbsp;Java研究组织&nbsp;版权所有 
            </FONT>
            </TD></TR>
        <TR>
          <TD bgColor=#995f14 height=1></TD></TR>
        </TBODY>
      </TABLE>
      
    </TD>
    <TD width=1 bgColor=#000000><IMG height=1 
      src="spacer.gif" width=1></TD>

  </TR>
  </TBODY>
</TABLE>
<!--end of bottom row-->    

    
</BODY></HTML>
